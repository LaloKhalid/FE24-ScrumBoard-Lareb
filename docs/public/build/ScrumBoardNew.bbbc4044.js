let e,t,n;var r,i,s,a,o,l,h,u,c,f,d,p,g,m,y,v,w,b,E,T=globalThis;class _{constructor(e,t,n){this.id=e,this.name=t,this.role=n}updateRole(e){this.role=e}display(){return`${this.name} (${this.role})`}}const I=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},S=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=e[n++],a=((7&i)<<18|(63&s)<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(1023&a))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},C={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,h=i>>2,u=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,f=63&l;!o&&(f=64,s||(c=64)),r.push(n[h],n[u],n[c],n[f])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(I(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):S(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new A;let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class A extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const D=function(e){let t=I(e);return C.encodeByteArray(t,!0)},x=function(e){return D(e).replace(/\./g,"")},N=function(e){try{return C.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},k=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==T)return T;throw Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&N(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},R=()=>k()?.config;class L{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function O(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function M(e){return(await fetch(e,{credentials:"include"})).ok}const P={};let V=!1;class U extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,U.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,F.prototype.create)}}class F{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(n=a,r=i,n.replace(B,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new U(s,l,i)}}const B=/\{\$([^}]+)}/g;function j(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if($(n)&&$(s)){if(!j(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function $(e){return null!==e&&"object"==typeof e}function q(e){return e&&e._delegate?e._delegate:e}class z{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const G="[DEFAULT]";class H{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new L;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:G})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=G){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=G){return this.instances.has(e)}getOptions(e=G){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);let i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===G?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=G){return this.component?this.component.multipleInstances?e:G:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class K{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new H(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Q=[];(r=i||(i={}))[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT";const W={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},X=i.INFO,Y={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},J=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=Y[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Z{constructor(e){this.name=e,this._logLevel=X,this._logHandler=J,this._userLogHandler=null,Q.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?W[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}const ee=new WeakMap,et=new WeakMap,en=new WeakMap,er=new WeakMap,ei=new WeakMap;let es={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return et.get(e);if("objectStoreNames"===t)return e.objectStoreNames||en.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ea(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ea(n){if(n instanceof IDBRequest){let e=new Promise((e,t)=>{let r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",s)},i=()=>{e(ea(n.result)),r()},s=()=>{t(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",s)});return e.then(e=>{e instanceof IDBCursor&&ee.set(e,n)}).catch(()=>{}),ei.set(e,n),e}if(er.has(n))return er.get(n);let r=function(n){if("function"==typeof n)return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(t||(t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(n)?function(...e){return n.apply(eo(this),e),ea(ee.get(this))}:function(...e){return ea(n.apply(eo(this),e))}:function(e,...t){let r=n.call(eo(this),e,...t);return en.set(r,e.sort?e.sort():[e]),ea(r)};return n instanceof IDBTransaction&&function(e){if(et.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});et.set(e,t)}(n),(e||(e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>n instanceof e)?new Proxy(n,es):n}(n);return r!==n&&(er.set(n,r),ei.set(r,n)),r}const eo=e=>ei.get(e),el=["get","getKey","getAll","getAllKeys","count"],eh=["put","add","delete","clear"],eu=new Map;function ec(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eu.get(t))return eu.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=eh.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||el.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return eu.set(t,s),s}es={...n=es,get:(e,t,r)=>ec(e,t)||n.get(e,t,r),has:(e,t)=>!!ec(e,t)||n.has(e,t)};class ef{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return t?.type==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}const ed="@firebase/app",ep="0.14.2",eg=new Z("@firebase/app"),em="[DEFAULT]",ey={[ed]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},ev=new Map,ew=new Map,eb=new Map;function eE(e,t){try{e.container.addComponent(t)}catch(n){eg.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function eT(e){let t=e.name;if(eb.has(t))return eg.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(eb.set(t,e),ev.values()))eE(n,e);for(let t of ew.values())eE(t,e);return!0}const e_=new F("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class eI{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new z("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw e_.create("app-deleted",{appName:this._name})}}function eS(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r={name:em,automaticDataCollectionEnabled:!0,...t},i=r.name;if("string"!=typeof i||!i)throw e_.create("bad-app-name",{appName:String(i)});if(n||(n=R()),!n)throw e_.create("no-options");let s=ev.get(i);if(s)if(j(n,s.options)&&j(r,s.config))return s;else throw e_.create("duplicate-app",{appName:i});let a=new K(i);for(let e of eb.values())a.addComponent(e);let o=new eI(n,r,a);return ev.set(i,o),o}function eC(e,t,n){let r=ey[e]??e;n&&(r+=`-${n}`);let i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${r}" with version "${t}":`];i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eg.warn(e.join(" "));return}eT(new z(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const eA="firebase-heartbeat-store";let eD=null;function ex(){return eD||(eD=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=ea(a);return r&&a.addEventListener("upgradeneeded",e=>{r(ea(a.result),e.oldVersion,e.newVersion,ea(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(eA)}catch(e){console.warn(e)}}}).catch(e=>{throw e_.create("idb-open",{originalErrorMessage:e.message})})),eD}async function eN(e){try{let t=(await ex()).transaction(eA),n=await t.objectStore(eA).get(eR(e));return await t.done,n}catch(e){if(e instanceof U)eg.warn(e.message);else{let t=e_.create("idb-get",{originalErrorMessage:e?.message});eg.warn(t.message)}}}async function ek(e,t){try{let n=(await ex()).transaction(eA,"readwrite"),r=n.objectStore(eA);await r.put(t,eR(e)),await n.done}catch(e){if(e instanceof U)eg.warn(e.message);else{let t=e_.create("idb-set",{originalErrorMessage:e?.message});eg.warn(t.message)}}}function eR(e){return`${e.name}!${e.options.appId}`}class eL{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new eM(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=eO();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eg.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=eO(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),eP(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),eP(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=x(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return eg.warn(e),""}}}function eO(){return new Date().toISOString().substring(0,10)}class eM{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await eN(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return ek(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return ek(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function eP(e){return x(JSON.stringify({version:2,heartbeats:e})).length}eT(new z("platform-logger",e=>new ef(e),"PRIVATE")),eT(new z("heartbeat",e=>new eL(e),"PRIVATE")),eC(ed,ep,""),eC(ed,ep,"esm2020"),eC("fire-js","");var eV="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==T?T:"undefined"!=typeof self?self:{},eU={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}var t=function(){this.blockSize=-1};function n(){}function r(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+0xd76aa478|0;a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[1]+0xe8c7b756|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[2]+0x242070db|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[3]+0xc1bdceee|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[4]+0xf57c0faf|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[5]+0x4787c62a|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[6]+0xa8304613|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[7]+0xfd469501|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[8]+0x698098d8|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[9]+0x8b44f7af|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[10]+0xffff5bb1|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[11]+0x895cd7be|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[12]+0x6b901122|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[13]+0xfd987193|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[14]+0xa679438e|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(a<<22|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,a=t+((n=i+(a<<20|a>>>12))^i^s)+r[5]+0xfffa3942|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[11]+0x6d9d6122|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[14]+0xfde5380c|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[1]+0xa4beea44|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[7]+0xf6bb4b60|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[10]+0xbebfbc70|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[13]+0x289b7ec6|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[3]+0xd4ef3085|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[6]+0x4881d05|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[9]+0xd9d4d039|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[15]+0x1fa27cf8|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(a<<23|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)},e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,i=this.B,s=this.h,a=0;a<t;){if(0==s)for(;a<=n;)r(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){r(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var o,l={};function h(e){var t;return -128<=e&&128>e?(t=function(e){return new i([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new i([0|e],0>e?-1:0)}function u(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return m(u(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new i(t,0)}var c=h(0),f=h(1),d=h(0x1000000);function p(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function m(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(f)}function y(e,t){return e.add(m(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function w(e,t){this.g=e,this.h=t}function b(e,t){if(p(t))throw Error("division by zero");if(p(e))return new w(c,c);if(g(e))return t=b(m(e),t),new w(m(t.g),m(t.h));if(g(t))return t=b(e,m(t)),new w(m(t.g),t.h);if(30<e.g.length){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var n=f,r=t;0>=r.l(e);)n=E(n),r=E(r);var i=T(n,1),s=T(r,1);for(r=T(r,2),n=T(n,2);!p(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=T(r,1),n=T(n,1)}return t=y(e,i.j(t)),new w(i,t)}for(i=c;0<=e.l(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=u(n)).j(t);g(a)||0<a.l(e);)n-=r,a=(s=u(n)).j(t);p(s)&&(s=f),i=i.add(s),e=y(e,a)}return new w(i,e)}function E(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function T(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,s=[],a=0;a<r;a++)s[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new i(s,e.h)}(o=i.prototype).m=function(){if(g(this))return-m(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:0x100000000+r)*t,t*=0x100000000}return e},o.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(g(this))return"-"+m(this).toString(e);for(var t=u(Math.pow(e,6)),n=this,r="";;){var i=b(n,t).g,s=((0<(n=y(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(p(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},o.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},o.l=function(e){return g(e=y(this,e))?-1:+!p(e)},o.abs=function(){return g(this)?m(this):this},o.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,s=0;s<=t;s++){var a=r+(65535&this.i(s))+(65535&e.i(s)),o=(a>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=o>>>16,a&=65535,o&=65535,n[s]=o<<16|a}return new i(n,-0x80000000&n[n.length-1]?-1:0)},o.j=function(e){if(p(this)||p(e))return c;if(g(this))return g(e)?m(this).j(m(e)):m(m(this).j(e));if(g(e))return m(this.j(m(e)));if(0>this.l(d)&&0>e.l(d))return u(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var a=this.i(r)>>>16,o=65535&this.i(r),l=e.i(s)>>>16,h=65535&e.i(s);n[2*r+2*s]+=o*h,v(n,2*r+2*s),n[2*r+2*s+1]+=a*h,v(n,2*r+2*s+1),n[2*r+2*s+1]+=o*l,v(n,2*r+2*s+1),n[2*r+2*s+2]+=a*l,v(n,2*r+2*s+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new i(n,0)},o.A=function(e){return b(this,e).h},o.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},o.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},o.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,a=eU.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.A,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=u,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return m(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=u(Math.pow(n,8)),i=c,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);8>a?(a=u(Math.pow(n,a)),i=i.j(a).add(u(o))):i=(i=i.j(r)).add(u(o))}return i},s=eU.Integer=i}).apply(void 0!==eV?eV:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var eF="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==T?T:"undefined"!=typeof self?self:{},eB={};(function(){var e,t,n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof eF&&eF];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var n=i;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in n))break e;n=n[a]}(t=t(s=n[e=e[e.length-1]]))!=s&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,n,r,i;return e=this,t=function(e,t){return t},e instanceof String&&(e+=""),n=0,r=!1,(i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return i},i}});var s=s||{},a=this||self;function g(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function m(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function y(e,t,n){return e.call.apply(e.bind,arguments)}function v(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function w(e,t,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function b(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function E(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function T(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function _(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(g(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function I(e){return/^[\s\xa0]*$/.test(e)}function S(){var e=a.navigator;return e&&(e=e.userAgent)?e:""}function C(e){return C[" "](e),e}C[" "]=function(){};var A=-1!=S().indexOf("Gecko")&&(-1==S().toLowerCase().indexOf("webkit")||-1!=S().indexOf("Edge"))&&-1==S().indexOf("Trident")&&-1==S().indexOf("MSIE")&&-1==S().indexOf("Edge");function D(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function x(e){let t={};for(let n in e)t[n]=e[n];return t}let N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<N.length;t++)n=N[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}var R=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new L,e=>e.reset());class L{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let O,M=!1,P=new class{constructor(){this.h=this.g=null}add(e,t){let n=R.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},V=()=>{let e=a.Promise.resolve(void 0);O=()=>{e.then(U)}};var U=()=>{let e;for(var t;e=null,P.g&&(e=P.g,P.g=P.g.next,P.g||(P.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}R.j(t),100>R.h&&(R.h++,t.next=R.g,R.g=t)}M=!1};function F(){this.s=this.s,this.C=this.C}function B(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}F.prototype.s=!1,F.prototype.ma=function(){this.s||(this.s=!0,this.N())},F.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},B.prototype.h=function(){this.defaultPrevented=!0};var j=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function $(e,t){if(B.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(A){e:{try{C(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:q[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&$.aa.h.call(this)}}E($,B);var q={2:"touch",3:"pen",4:"mouse"};$.prototype.h=function(){$.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var z="closure_listenable_"+(1e6*Math.random()|0),G=0;function H(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++G,this.da=this.fa=!1}function K(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Q(e){this.src=e,this.g={},this.h=0}function W(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(K(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function X(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}Q.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=X(e,t,r,i);return -1<a?(t=e[a],n||(t.fa=!1)):((t=new H(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var Y="closure_lm_"+(1e6*Math.random()|0),J={};function Z(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=m(i)?!!i.capture:!!i,o=er(e);if(o||(e[Y]=o=new Q(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return en.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)j||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(et(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function ee(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[z])W(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(et(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=er(t))?(W(n,e),0==n.h&&(n.src=null,t[Y]=null)):K(e)}}}function et(e){return e in J?J[e]:J[e]="on"+e}function en(e,t){if(e.da)e=!0;else{t=new $(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&ee(e),e=n.call(r,t)}return e}function er(e){return(e=e[Y])instanceof Q?e:null}var ei="__closure_events_fn_"+(1e9*Math.random()>>>0);function es(e){return"function"==typeof e?e:(e[ei]||(e[ei]=function(t){return e.handleEvent(t)}),e[ei])}function ea(){F.call(this),this.i=new Q(this),this.M=this,this.F=null}function eo(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new B(t,e);else if(t instanceof B)t.target=t.target||e;else{var i=t;k(t=new B(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=el(a,r,!0,t)&&i}if(i=el(a=t.g=e,r,!0,t)&&i,i=el(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=el(a=t.g=n[s],r,!1,t)&&i}function el(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.fa&&W(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}function eh(e,t,n){if("function"==typeof e)n&&(e=w(e,n));else if(e&&"function"==typeof e.handleEvent)e=w(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:a.setTimeout(e,t||0)}E(ea,F),ea.prototype[z]=!0,ea.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=m(i)?!!i.capture:!!i,r=es(r),t&&t[z])?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=X(a=t.g[n],r,i,s))&&(K(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=er(t))&&(n=t.g[n.toString()],t=-1,n&&(t=X(n,r,i,s)),(r=-1<t?n[t]:null)&&ee(r))}(this,e,t,n,r)},ea.prototype.N=function(){if(ea.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)K(n[r]);delete t.g[e],t.h--}}this.F=null},ea.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ea.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class eu extends F{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eh(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ec(e){F.call(this),this.h=e,this.g={}}E(ec,F);var ef=[];function ed(e){D(e.g,function(e,t){this.g.hasOwnProperty(t)&&ee(e)},e),e.g={}}ec.prototype.N=function(){ec.aa.N.call(this),ed(this)},ec.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ep=a.JSON.stringify,eg=a.JSON.parse,em=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ey(){}function ev(e){return e.h||(e.h=e.i())}function ew(){}ey.prototype.h=null;var eb={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eE(){B.call(this,"d")}function eT(){B.call(this,"c")}E(eE,B),E(eT,B);var e_={},eI=null;function eS(){return eI=eI||new ea}function eC(e){B.call(this,e_.La,e)}function eA(e){let t=eS();eo(t,new eC(t))}function eD(e,t){B.call(this,e_.STAT_EVENT,e),this.stat=t}function ex(e){let t=eS();eo(t,new eD(t,e))}function eN(e,t){B.call(this,e_.Ma,e),this.size=t}function ek(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eR(){this.g=!0}function eL(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return ep(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}e_.La="serverreachability",E(eC,B),e_.STAT_EVENT="statevent",E(eD,B),e_.Ma="timingevent",E(eN,B),eR.prototype.xa=function(){this.g=!1},eR.prototype.info=function(){};var eO={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eM={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eP(){}function eV(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ec(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new eU}function eU(){this.i=null,this.g="",this.h=!1}E(eP,ey),eP.prototype.g=function(){return new XMLHttpRequest},eP.prototype.i=function(){return{}},t=new eP;var ej={},e$={};function eq(e,t,n){e.L=1,e.v=ti(e9(t)),e.m=n,e.P=!0,ez(e,null)}function ez(e,t){e.F=Date.now(),eH(e),e.A=e9(e.v);var n,r,i,s,a,o,l=e.A,h=e.R;Array.isArray(h)||(h=[String(h)]),ty(l.i,"t",h),e.C=0,l=e.j.J,e.h=new eU,e.g=t6(e.j,l?t:null,!e.m),0<e.O&&(e.M=new eu(w(e.Y,e,e.g),e.O)),t=e.U,l=e.g,h=e.ca;var u="readystatechange";Array.isArray(u)||(u&&(ef[0]=u.toString()),u=ef);for(var c=0;c<u.length;c++){var f=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=es(r),t&&t[z]?t.L(n,r,m(i)?!!i.capture:!!i,s):Z(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=es(r),t&&t[z]?t.K(n,r,m(i)?!!i.capture:!!i,s):Z(t,n,r,!1,i,s)}(l,u[c],h||t.handleEvent,!1,t.h||t);if(!f)break;t.g[f.key]=f}t=e.H?x(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),eA(),n=e.i,r=e.u,i=e.A,s=e.l,a=e.R,o=e.m,n.info(function(){if(n.g)if(o)for(var e="",t=o.split("&"),l=0;l<t.length;l++){var h=t[l].split("=");if(1<h.length){var u=h[0];h=h[1];var c=u.split("_");e=2<=c.length&&"type"==c[1]?e+(u+"=")+h+"&":e+(u+"=redacted&")}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+r+"\n"+i+"\n"+e})}function eG(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function eH(e){e.S=Date.now()+e.I,eK(e,e.I)}function eK(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=ek(w(e.ba,e),t)}function eQ(e){e.B&&(a.clearTimeout(e.B),e.B=null)}function eW(e){0==e.j.G||e.J||tJ(e.j,e)}function eX(e){eQ(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ed(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eY(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||e2(n.h,e))){if(!e.K&&e2(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)tY(n),tj(n);else break e;tQ(n),ex(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=ek(w(n.Za,n),6e3));if(1>=e1(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else t0(n,11)}else if((e.K||n.g==e)&&tY(n),!I(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let o=i[t];if(n.T=o[0],o=o[1],2==n.G)if("c"==o[0]){n.K=o[1],n.ia=o[2];let t=o[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));let i=o[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(n.L=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(e6(s,s.h),s.h=null))}if(r.D){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,tr(r.I,r.D,e))}}if(n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms")),(r=n).qa=t2(r,r.J?r.ia:null,r.W),e.K){e3(r.h,e);var a=r.L;a&&(e.I=a),e.B&&(eQ(e),eH(e)),r.g=e}else tK(r);0<n.i.length&&tq(n)}else"stop"!=o[0]&&"close"!=o[0]||t0(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?t0(n,7):tB(n):"noop"!=o[0]&&n.l&&n.l.ta(o),n.v=0)}}eA(4)}catch(e){}}eV.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tP(e)?t.j():this.Y(e)},eV.prototype.Y=function(e){try{if(e==this.g)e:{let v=tP(this.g);var t=this.g.Ba();let w=this.g.Z();if(!(3>v)&&(3!=v||this.g&&(this.h.h||this.g.oa()||tV(this.g)))){this.J||4!=v||7==t||(8==t||0>=w?eA(3):eA(2)),eQ(this);var n=this.g.Z();this.X=n;t:if(eG(this)){var r=tV(this.g);e="";var i=r.length,s=4==tP(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eX(this),eW(this);var o="";break t}this.h.i=new a.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,l=this.i,h=this.u,u=this.A,c=this.l,f=this.R,d=n,l.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+f+"]: "+h+"\n"+u+"\n"+v+" "+d}),this.o){if(this.T&&!this.K){t:{if(this.g){var l,h,u,c,f,d,p,g=this.g;if((p=g.g?g.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(p)){var m=p;break t}}m=null}if(n=m)eL(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eY(this,n);else{this.o=!1,this.s=3,ex(12),eX(this),eW(this);break e}}if(this.P){let e;for(n=!0;!this.J&&this.C<o.length;)if((e=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?e$:isNaN(n=Number(t.substring(n,r)))?ej:(r+=1)+n>t.length?e$:(t=t.slice(r,r+n),e.C=r+n,t)}(this,o))==e$){4==v&&(this.s=4,ex(14),n=!1),eL(this.i,this.l,null,"[Incomplete Response]");break}else if(e==ej){this.s=4,ex(15),eL(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}else eL(this.i,this.l,e,null),eY(this,e);if(eG(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=v||0!=o.length||this.h.h||(this.s=1,ex(16),n=!1),this.o=this.o&&n,n){if(0<o.length&&!this.W){this.W=!0;var y=this.j;y.g==this&&y.ba&&!y.M&&(y.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),tW(y),y.M=!0,ex(11))}}else eL(this.i,this.l,o,"[Invalid Chunked Response]"),eX(this),eW(this)}else eL(this.i,this.l,o,null),eY(this,o);4==v&&eX(this),this.o&&!this.J&&(4==v?tJ(this.j,this):(this.o=!1,eH(this)))}else(function(e){let t={};e=(e.g&&2<=tP(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(I(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,ex(12)):(this.s=0,ex(13)),eX(this),eW(this)}}}catch(e){}finally{}},eV.prototype.cancel=function(){this.J=!0,eX(this)},eV.prototype.ba=function(){var e,t;this.B=null;let n=Date.now();0<=n-this.S?(e=this.i,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(eA(),ex(17)),eX(this),this.s=2,eW(this)):eK(this,this.S-n)};var eJ=class{constructor(e,t){this.g=e,this.map=t}};function eZ(e){this.l=e||10,e=a.PerformanceNavigationTiming?0<(e=a.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function e0(e){return!!e.h||!!e.g&&e.g.size>=e.j}function e1(e){return e.h?1:e.g?e.g.size:0}function e2(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function e6(e,t){e.g?e.g.add(t):e.h=t}function e3(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e5(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return T(e.i)}function e4(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(g(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(g(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(g(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}eZ.prototype.cancel=function(){if(this.i=e5(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e8=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e7(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof e7){this.h=e.h,te(this,e.j),this.o=e.o,this.g=e.g,tt(this,e.s),this.l=e.l;var t=e.i,n=new td;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tn(this,n),this.m=e.m}else e&&(t=String(e).match(e8))?(this.h=!1,te(this,t[1]||"",!0),this.o=ts(t[2]||""),this.g=ts(t[3]||"",!0),tt(this,t[4]),this.l=ts(t[5]||"",!0),tn(this,t[6]||"",!0),this.m=ts(t[7]||"")):(this.h=!1,this.i=new td(null,this.h))}function e9(e){return new e7(e)}function te(e,t,n){e.j=n?ts(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tt(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function tn(e,t,n){var r,i;t instanceof td?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(tp(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tg(this,t),ty(this,n,e))},r)),r.j=i):(n||(t=ta(t,tc)),e.i=new td(t,e.h))}function tr(e,t,n){e.i.set(t,n)}function ti(e){return tr(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function ts(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ta(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,to),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function to(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e7.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ta(t,tl,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ta(t,tl,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ta(n,"/"==n.charAt(0)?tu:th,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ta(n,tf)),e.join("")};var tl=/[#\/\?@]/g,th=/[#\?:]/g,tu=/[#\?]/g,tc=/[#\?@]/g,tf=/#/g;function td(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tp(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tg(e,t){tp(e),t=tv(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tm(e,t){return tp(e),t=tv(e,t),e.g.has(t)}function ty(e,t,n){tg(e,t),0<n.length&&(e.i=null,e.g.set(tv(e,t),T(n)),e.h+=n.length)}function tv(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tw(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tb(){this.g=new em}function tE(e){this.l=e.Ub||null,this.j=e.eb||!1}function tT(e,t){ea.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function t_(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tI(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tS(e)}function tS(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tC(e){let t="";return D(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tA(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tC(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tr(e,t,n))}function tD(e){ea.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(n=td.prototype).add=function(e,t){tp(this),this.i=null,e=tv(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},n.forEach=function(e,t){tp(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},n.na=function(){tp(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},n.V=function(e){tp(this);let t=[];if("string"==typeof e)tm(this,e)&&(t=t.concat(this.g.get(tv(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},n.set=function(e,t){return tp(this),this.i=null,tm(this,e=tv(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},n.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.V(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")},E(tE,ey),tE.prototype.g=function(){return new tT(this.l,this.j)},tE.prototype.i=(e={},function(){return e}),E(tT,ea),(n=tT.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tS(this)},n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||a).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tI(this)),this.readyState=0},n.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tS(this)),this.g&&(this.readyState=3,tS(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;t_(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},n.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tI(this):tS(this),3==this.readyState&&t_(this)}},n.Ra=function(e){this.g&&(this.response=this.responseText=e,tI(this))},n.Qa=function(e){this.g&&(this.response=e,tI(this))},n.ga=function(){this.g&&tI(this)},n.setRequestHeader=function(e,t){this.u.append(e,t)},n.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tT.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),E(tD,ea);var tx=/^https?$/i,tN=["POST","PUT"];function tk(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tR(e),tO(e)}function tR(e){e.A||(e.A=!0,eo(e,"complete"),eo(e,"error"))}function tL(e){if(e.h&&void 0!==s&&(!e.v[1]||4!=tP(e)||2!=e.Z())){if(e.u&&4==tP(e))eh(e.Ea,0,e);else if(eo(e,"readystatechange"),4==tP(e)){e.h=!1;try{let s=e.Z();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){var i=String(e.D).match(e8)[1]||null;!i&&a.self&&a.self.location&&(i=a.self.location.protocol.slice(0,-1)),n=!tx.test(i?i.toLowerCase():"")}t=n}if(t)eo(e,"complete"),eo(e,"success");else{e.m=6;try{var o=2<tP(e)?e.g.statusText:""}catch(e){o=""}e.l=o+" ["+e.Z()+"]",tR(e)}}finally{tO(e)}}}}function tO(e,t){if(e.g){tM(e);let n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||eo(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function tM(e){e.I&&(a.clearTimeout(e.I),e.I=null)}function tP(e){return e.g?e.g.readyState:0}function tV(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tU(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tF(e){this.Aa=0,this.i=[],this.j=new eR,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tU("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tU("baseRetryDelayMs",5e3,e),this.cb=tU("retryDelaySeedMs",1e4,e),this.Wa=tU("forwardChannelMaxRetries",2,e),this.wa=tU("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new eZ(e&&e.concurrentRequestLimit),this.Da=new tb,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tB(e){if(t$(e),3==e.G){var t=e.U++,n=e9(e.I);if(tr(n,"SID",e.K),tr(n,"RID",t),tr(n,"TYPE","terminate"),tG(e,n),(t=new eV(e,e.j,t)).L=2,t.v=ti(e9(n)),n=!1,a.navigator&&a.navigator.sendBeacon)try{n=a.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&a.Image&&((new Image).src=t.v,n=!0),n||(t.g=t6(t.j,null),t.g.ea(t.v)),t.F=Date.now(),eH(t)}t1(e)}function tj(e){e.g&&(tW(e),e.g.cancel(),e.g=null)}function t$(e){tj(e),e.u&&(a.clearTimeout(e.u),e.u=null),tY(e),e.h.cancel(),e.s&&("number"==typeof e.s&&a.clearTimeout(e.s),e.s=null)}function tq(e){if(!e0(e.h)&&!e.s){e.s=!0;var t=e.Ga;O||V(),M||(O(),M=!0),P.add(t,e),e.B=0}}function tz(e,t){var n;n=t?t.l:e.U++;let r=e9(e.I);tr(r,"SID",e.K),tr(r,"RID",n),tr(r,"AID",e.T),tG(e,r),e.m&&e.o&&tA(r,e.m,e.o),n=new eV(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tH(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),e6(e.h,n),eq(n,r,t)}function tG(e,t){e.H&&D(e.H,function(e,n){tr(t,n,e)}),e.l&&e4({},function(e,n){tr(t,n,e)})}function tH(e,t,n){n=Math.min(e.i.length,n);var r=e.l?w(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g,o=i[a].map;if(0>(n-=t))t=Math.max(0,i[a].g-100),s=!1;else try{!function(e,t,n){let r=n||"";try{e4(e,function(e,n){let i=e;m(e)&&(i=ep(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break e}}}return t.D=e=e.i.splice(0,n),r}function tK(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;O||V(),M||(O(),M=!0),P.add(t,e),e.v=0}}function tQ(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=ek(w(e.Fa,e),tZ(e,e.v)),e.v++,!0)}function tW(e){null!=e.A&&(a.clearTimeout(e.A),e.A=null)}function tX(e){e.g=new eV(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=e9(e.qa);tr(t,"RID","rpc"),tr(t,"SID",e.K),tr(t,"AID",e.T),tr(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&tr(t,"TO",e.ja),tr(t,"TYPE","xmlhttp"),tG(e,t),e.m&&e.o&&tA(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ti(e9(t)),n.m=null,n.P=!0,ez(n,e)}function tY(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tJ(e,t){var n,r=null;if(e.g==t){tY(e),tW(e),e.g=null;var i=2}else{if(!e2(e.h,t))return;r=t.D,e3(e.h,t),i=1}if(0!=e.G){if(t.o)if(1==i){r=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;eo(i=eS(),new eN(i,r)),tq(e)}else tK(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==i&&(n=t,!(e1(e.h)>=e.h.j-!!e.s)&&(e.s?(e.i=n.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=ek(w(e.Ga,e,n),tZ(e,e.B)),e.B++,!0)))||2==i&&tQ(e)))switch(r&&0<r.length&&((t=e.h).i=t.i.concat(r)),s){case 1:t0(e,5);break;case 4:t0(e,10);break;case 3:t0(e,6);break;default:t0(e,2)}}}function tZ(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function t0(e,t){if(e.j.info("Error code "+t),2==t){var n=w(e.fb,e),r=e.Xa;let t=!r;r=new e7(r||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||te(r,"https"),ti(r),t?function(e,t){let n=new eR;if(a.Image){let r=new Image;r.onload=b(tw,n,"TestLoadImage: loaded",!0,t,r),r.onerror=b(tw,n,"TestLoadImage: error",!1,t,r),r.onabort=b(tw,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=b(tw,n,"TestLoadImage: timeout",!1,t,r),a.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){let n=new eR,r=new AbortController,i=setTimeout(()=>{r.abort(),tw(n,"TestPingServer: timeout",!1,t)},1e4);fetch(e,{signal:r.signal}).then(e=>{clearTimeout(i),e.ok?tw(n,"TestPingServer: ok",!0,t):tw(n,"TestPingServer: server error",!1,t)}).catch(()=>{clearTimeout(i),tw(n,"TestPingServer: error",!1,t)})}(r.toString(),n)}else ex(2);e.G=0,e.l&&e.l.sa(t),t1(e),t$(e)}function t1(e){if(e.G=0,e.ka=[],e.l){let t=e5(e.h);(0!=t.length||0!=e.i.length)&&(_(e.ka,t),_(e.ka,e.i),e.h.i.length=0,T(e.i),e.i.length=0),e.l.ra()}}function t2(e,t,n){var r=n instanceof e7?e9(n):new e7(n);if(""!=r.g)t&&(r.g=t+"."+r.g),tt(r,r.s);else{var i=a.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new e7(null);r&&te(s,r),t&&(s.g=t),i&&tt(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&tr(r,n,t),tr(r,"VER",e.la),tG(e,r),r}function t6(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tD(e.Ca&&!e.pa?new tE({eb:n}):e.pa)).Ha(e.J),t}function t3(){}function t5(){}function t4(e,t){ea.call(this),this.g=new tF(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!I(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!I(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t9(this)}function t8(e){eE.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t7(){eT.call(this),this.status=1}function t9(e){this.g=e}(n=tD.prototype).Ha=function(e){this.J=e},n.ea=function(e,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);n=n?n.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():t.g(),this.v=this.o?ev(this.o):ev(t),this.g.onreadystatechange=w(this.Ea,this);try{this.B=!0,this.g.open(n,String(e),!0),this.B=!1}catch(e){tk(this,e);return}if(e=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[t,o]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&e instanceof a.FormData,!(0<=Array.prototype.indexOf.call(tN,n,void 0))||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(t,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tM(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tk(this,e)}},n.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,eo(this,"complete"),eo(this,"abort"),tO(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tO(this,!0)),tD.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?tL(this):this.bb())},n.bb=function(){tL(this)},n.isActive=function(){return!!this.g},n.Z=function(){try{return 2<tP(this)?this.g.status:-1}catch(e){return -1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},n.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eg(t)}},n.Ba=function(){return this.m},n.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(n=tF.prototype).la=8,n.G=1,n.connect=function(e,t,n,r){ex(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=t2(this,null,this.W),tq(this)},n.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let i=new eV(this,this.j,e),s=this.o;if(this.S&&(s?k(s=x(s),this.S):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tH(this,i,t),tr(n=e9(this.I),"RID",e),tr(n,"CVER",22),this.D&&tr(n,"X-HTTP-Session-Id",this.D),tG(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(tC(s)))+"&"+t:this.m&&tA(n,this.m,s)),e6(this.h,i),this.Ua&&tr(n,"TYPE","init"),this.P?(tr(n,"$req",t),tr(n,"SID","null"),i.T=!0,eq(i,n,null)):eq(i,n,t),this.G=2}}else 3==this.G&&(e?tz(this,e):0==this.i.length||e0(this.h)||tz(this))},n.Fa=function(){if(this.u=null,tX(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=ek(w(this.ab,this),e)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ex(10),tj(this),tX(this))},n.Za=function(){null!=this.C&&(this.C=null,tj(this),tQ(this),ex(19))},n.fb=function(e){e?(this.j.info("Successfully pinged google.com"),ex(2)):(this.j.info("Failed to ping google.com"),ex(1))},n.isActive=function(){return!!this.l&&this.l.isActive(this)},(n=t3.prototype).ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){},t5.prototype.g=function(e,t){return new t4(e,t)},E(t4,ea),t4.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t4.prototype.close=function(){tB(this.g)},t4.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ep(e),e=n);t.i.push(new eJ(t.Ya++,e)),3==t.G&&tq(t)},t4.prototype.N=function(){this.g.l=null,delete this.j,tB(this.g),delete this.g,t4.aa.N.call(this)},E(t8,eE),E(t7,eT),E(t9,t3),t9.prototype.ua=function(){eo(this.g,"a")},t9.prototype.ta=function(e){eo(this.g,new t8(e))},t9.prototype.sa=function(e){eo(this.g,new t7)},t9.prototype.ra=function(){eo(this.g,"b")},t5.prototype.createWebChannel=t5.prototype.g,t4.prototype.send=t4.prototype.o,t4.prototype.open=t4.prototype.m,t4.prototype.close=t4.prototype.close,p=eB.createWebChannelTransport=function(){return new t5},d=eB.getStatEventTarget=function(){return eS()},f=eB.Event=e_,c=eB.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eO.NO_ERROR=0,eO.TIMEOUT=8,eO.HTTP_ERROR=6,u=eB.ErrorCode=eO,eM.COMPLETE="complete",h=eB.EventType=eM,ew.EventType=eb,eb.OPEN="a",eb.CLOSE="b",eb.ERROR="c",eb.MESSAGE="d",ea.prototype.listen=ea.prototype.K,l=eB.WebChannel=ew,eB.FetchXmlHttpFactory=tE,tD.prototype.listenOnce=tD.prototype.L,tD.prototype.getLastError=tD.prototype.Ka,tD.prototype.getLastErrorCode=tD.prototype.Ba,tD.prototype.getStatus=tD.prototype.Z,tD.prototype.getResponseJson=tD.prototype.Oa,tD.prototype.getResponseText=tD.prototype.oa,tD.prototype.send=tD.prototype.ea,tD.prototype.setWithCredentials=tD.prototype.Ha,o=eB.XhrIo=tD}).apply(void 0!==eF?eF:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),g=function(e){for(var t,n=e.length,r=n%3,i=[],s=0,a=n-r;s<a;s+=16383)i.push(function(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&0xff0000)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(ej[r>>18&63]+ej[r>>12&63]+ej[r>>6&63]+ej[63&r]);return i.join("")}(e,s,s+16383>a?a:s+16383));return 1===r?i.push(ej[(t=e[n-1])>>2]+ej[t<<4&63]+"=="):2===r&&i.push(ej[(t=(e[n-2]<<8)+e[n-1])>>10]+ej[t>>4&63]+ej[t<<2&63]+"="),i.join("")};for(var ej=[],e$=[],eq="undefined"!=typeof Uint8Array?Uint8Array:Array,ez="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",eG=0,eH=ez.length;eG<eH;++eG)ej[eG]=ez[eG],e$[ez.charCodeAt(eG)]=eG;e$[45]=62,e$[95]=63,m=function(e,t,n,r,i){var s,a,o=8*i-r-1,l=(1<<o)-1,h=l>>1,u=-7,c=n?i-1:0,f=n?-1:1,d=e[t+c];for(c+=f,s=d&(1<<-u)-1,d>>=-u,u+=o;u>0;s=256*s+e[t+c],c+=f,u-=8);for(a=s&(1<<-u)-1,s>>=-u,u+=r;u>0;a=256*a+e[t+c],c+=f,u-=8);if(0===s)s=1-h;else{if(s===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r),s-=h}return(d?-1:1)*a*Math.pow(2,s-r)},y=function(e,t,n,r,i,s){var a,o,l,h=8*s-i-1,u=(1<<h)-1,c=u>>1,f=5960464477539062e-23*(23===i),d=r?0:s-1,p=r?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=f/l:t+=f*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=u?(o=0,a=u):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[n+d]=255&o,d+=p,o/=256,i-=8);for(a=a<<i|o,h+=i;h>0;e[n+d]=255&a,d+=p,a/=256,h-=8);e[n+d-p]|=128*g};const eK="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function eQ(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,eW.prototype),t}function eW(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return eJ(e)}return eX(e,t,n)}function eX(e,t,n){if("string"==typeof e){var r=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!eW.isEncoding(i))throw TypeError("Unknown encoding: "+i);let n=0|e2(r,i),s=eQ(n),a=s.write(r,i);return a!==n&&(s=s.slice(0,a)),s}if(ArrayBuffer.isView(e)){var s=e;if(tg(s,Uint8Array)){let e=new Uint8Array(s);return e0(e.buffer,e.byteOffset,e.byteLength)}return eZ(s)}if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(tg(e,ArrayBuffer)||e&&tg(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(tg(e,SharedArrayBuffer)||e&&tg(e.buffer,SharedArrayBuffer)))return e0(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let a=e.valueOf&&e.valueOf();if(null!=a&&a!==e)return eW.from(a,t,n);let o=function(e){if(eW.isBuffer(e)){let t=0|e1(e.length),n=eQ(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?eQ(0):eZ(e):"Buffer"===e.type&&Array.isArray(e.data)?eZ(e.data):void 0}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return eW.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function eY(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function eJ(e){return eY(e),eQ(e<0?0:0|e1(e))}function eZ(e){let t=e.length<0?0:0|e1(e.length),n=eQ(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function e0(e,t,n){let r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),eW.prototype),r}function e1(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function e2(e,t){if(eW.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||tg(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return tf(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return td(e).length;default:if(i)return r?-1:tf(e).length;t=(""+t).toLowerCase(),i=!0}}function e6(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){let r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let r=t;r<n;++r)i+=tm[e[r]];return i}(this,t,n);case"utf8":case"utf-8":return e8(this,t,n);case"ascii":return function(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,n);case"latin1":case"binary":return function(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}(this,t,n);case"base64":var i,s,a;return i=this,s=t,a=n,0===s&&a===i.length?g(i):g(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){let r=e.slice(t,n),i="";for(let e=0;e<r.length-1;e+=2)i+=String.fromCharCode(r[e]+256*r[e+1]);return i}(this,t,n);default:if(r)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function e3(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function e5(e,t,n,r,i){var s;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(i)return -1;else n=e.length-1;else if(n<0)if(!i)return -1;else n=0;if("string"==typeof t&&(t=eW.from(t,r)),eW.isBuffer(t))return 0===t.length?-1:e4(e,t,n,r,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return e4(e,[t],n,r,i)}throw TypeError("val must be string, number or Buffer")}function e4(e,t,n,r,i){let s,a=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,n/=2}function h(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){let r=-1;for(s=n;s<o;s++)if(h(e,s)===h(t,-1===r?0:s-r)){if(-1===r&&(r=s),s-r+1===l)return r*a}else -1!==r&&(s-=s-r),r=-1}else for(n+l>o&&(n=o-l),s=n;s>=0;s--){let n=!0;for(let r=0;r<l;r++)if(h(e,s+r)!==h(t,r)){n=!1;break}if(n)return s}return -1}function e8(e,t,n){n=Math.min(e.length,n);let r=[],i=t;for(;i<n;){let t=e[i],s=null,a=t>239?4:t>223?3:t>191?2:1;if(i+a<=n){let n,r,o,l;switch(a){case 1:t<128&&(s=t);break;case 2:(192&(n=e[i+1]))==128&&(l=(31&t)<<6|63&n)>127&&(s=l);break;case 3:n=e[i+1],r=e[i+2],(192&n)==128&&(192&r)==128&&(l=(15&t)<<12|(63&n)<<6|63&r)>2047&&(l<55296||l>57343)&&(s=l);break;case 4:n=e[i+1],r=e[i+2],o=e[i+3],(192&n)==128&&(192&r)==128&&(192&o)==128&&(l=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&o)>65535&&l<1114112&&(s=l)}}null===s?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=a}var s=r;let a=s.length;if(a<=4096)return String.fromCharCode.apply(String,s);let o="",l=0;for(;l<a;)o+=String.fromCharCode.apply(String,s.slice(l,l+=4096));return o}function e7(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function e9(e,t,n,r,i,s){if(!eW.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function te(e,t,n,r,i){tl(t,r,i,e,n,7);let s=Number(t&BigInt(0xffffffff));e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s;let a=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,n}function tt(e,t,n,r,i){tl(t,r,i,e,n,7);let s=Number(t&BigInt(0xffffffff));e[n+7]=s,s>>=8,e[n+6]=s,s>>=8,e[n+5]=s,s>>=8,e[n+4]=s;let a=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n+3]=a,a>>=8,e[n+2]=a,a>>=8,e[n+1]=a,a>>=8,e[n]=a,n+8}function tn(e,t,n,r,i,s){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function tr(e,t,n,r,i){return t*=1,n>>>=0,i||tn(e,t,n,4,34028234663852886e22,-34028234663852886e22),y(e,t,n,r,23,4),n+4}function ti(e,t,n,r,i){return t*=1,n>>>=0,i||tn(e,t,n,8,17976931348623157e292,-17976931348623157e292),y(e,t,n,r,52,8),n+8}eW.TYPED_ARRAY_SUPPORT=function(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),eW.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(eW.prototype,"parent",{enumerable:!0,get:function(){if(eW.isBuffer(this))return this.buffer}}),Object.defineProperty(eW.prototype,"offset",{enumerable:!0,get:function(){if(eW.isBuffer(this))return this.byteOffset}}),eW.poolSize=8192,eW.from=function(e,t,n){return eX(e,t,n)},Object.setPrototypeOf(eW.prototype,Uint8Array.prototype),Object.setPrototypeOf(eW,Uint8Array),eW.alloc=function(e,t,n){return(eY(e),e<=0)?eQ(e):void 0!==t?"string"==typeof n?eQ(e).fill(t,n):eQ(e).fill(t):eQ(e)},eW.allocUnsafe=function(e){return eJ(e)},eW.allocUnsafeSlow=function(e){return eJ(e)},eW.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==eW.prototype},eW.compare=function(e,t){if(tg(e,Uint8Array)&&(e=eW.from(e,e.offset,e.byteLength)),tg(t,Uint8Array)&&(t=eW.from(t,t.offset,t.byteLength)),!eW.isBuffer(e)||!eW.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:+(r<n)},eW.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},eW.concat=function(e,t){let n;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return eW.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;let r=eW.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){let t=e[n];if(tg(t,Uint8Array))i+t.length>r.length?(eW.isBuffer(t)||(t=eW.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else if(eW.isBuffer(t))t.copy(r,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=t.length}return r},eW.byteLength=e2,eW.prototype._isBuffer=!0,eW.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)e3(this,t,t+1);return this},eW.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)e3(this,t,t+3),e3(this,t+1,t+2);return this},eW.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)e3(this,t,t+7),e3(this,t+1,t+6),e3(this,t+2,t+5),e3(this,t+3,t+4);return this},eW.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?e8(this,0,e):e6.apply(this,arguments)},eW.prototype.toLocaleString=eW.prototype.toString,eW.prototype.equals=function(e){if(!eW.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===eW.compare(this,e)},eW.prototype.inspect=function(){let e="";return e=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(e+=" ... "),"<Buffer "+e+">"},eK&&(eW.prototype[eK]=eW.prototype.inspect),eW.prototype.compare=function(e,t,n,r,i){if(tg(e,Uint8Array)&&(e=eW.from(e,e.offset,e.byteLength)),!eW.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;let s=i-r,a=n-t,o=Math.min(s,a),l=this.slice(r,i),h=e.slice(t,n);for(let e=0;e<o;++e)if(l[e]!==h[e]){s=l[e],a=h[e];break}return s<a?-1:+(a<s)},eW.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},eW.prototype.indexOf=function(e,t,n){return e5(this,e,t,n,!0)},eW.prototype.lastIndexOf=function(e,t,n){return e5(this,e,t,n,!1)},eW.prototype.write=function(e,t,n,r){var i,s,a,o,l,h,u,c;if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let f=this.length-t;if((void 0===n||n>f)&&(n=f),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let d=!1;for(;;)switch(r){case"hex":return function(e,t,n,r){let i;n=Number(n)||0;let s=e.length-n;r?(r=Number(r))>s&&(r=s):r=s;let a=t.length;for(r>a/2&&(r=a/2),i=0;i<r;++i){var o;let r=parseInt(t.substr(2*i,2),16);if((o=r)!=o)break;e[n+i]=r}return i}(this,e,t,n);case"utf8":case"utf-8":return i=t,s=n,tp(tf(e,this.length-i),this,i,s);case"ascii":case"latin1":case"binary":return a=t,o=n,tp(function(e){let t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(e),this,a,o);case"base64":return l=t,h=n,tp(td(e),this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,c=n,tp(function(e,t){let n,r,i=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i.push(n%256),i.push(r);return i}(e,this.length-u),this,u,c);default:if(d)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),d=!0}},eW.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},eW.prototype.slice=function(e,t){let n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);let r=this.subarray(e,t);return Object.setPrototypeOf(r,eW.prototype),r},eW.prototype.readUintLE=eW.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||e7(e,t,this.length);let r=this[e],i=1,s=0;for(;++s<t&&(i*=256);)r+=this[e+s]*i;return r},eW.prototype.readUintBE=eW.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||e7(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},eW.prototype.readUint8=eW.prototype.readUInt8=function(e,t){return e>>>=0,t||e7(e,1,this.length),this[e]},eW.prototype.readUint16LE=eW.prototype.readUInt16LE=function(e,t){return e>>>=0,t||e7(e,2,this.length),this[e]|this[e+1]<<8},eW.prototype.readUint16BE=eW.prototype.readUInt16BE=function(e,t){return e>>>=0,t||e7(e,2,this.length),this[e]<<8|this[e+1]},eW.prototype.readUint32LE=eW.prototype.readUInt32LE=function(e,t){return e>>>=0,t||e7(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},eW.prototype.readUint32BE=eW.prototype.readUInt32BE=function(e,t){return e>>>=0,t||e7(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},eW.prototype.readBigUInt64LE=ty(function(e){th(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&tu(e,this.length-8);let r=t+256*this[++e]+65536*this[++e]+0x1000000*this[++e],i=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*n;return BigInt(r)+(BigInt(i)<<BigInt(32))}),eW.prototype.readBigUInt64BE=ty(function(e){th(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&tu(e,this.length-8);let r=0x1000000*t+65536*this[++e]+256*this[++e]+this[++e],i=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)}),eW.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||e7(e,t,this.length);let r=this[e],i=1,s=0;for(;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},eW.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||e7(e,t,this.length);let r=t,i=1,s=this[e+--r];for(;r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},eW.prototype.readInt8=function(e,t){return(e>>>=0,t||e7(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},eW.prototype.readInt16LE=function(e,t){e>>>=0,t||e7(e,2,this.length);let n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},eW.prototype.readInt16BE=function(e,t){e>>>=0,t||e7(e,2,this.length);let n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},eW.prototype.readInt32LE=function(e,t){return e>>>=0,t||e7(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},eW.prototype.readInt32BE=function(e,t){return e>>>=0,t||e7(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},eW.prototype.readBigInt64LE=ty(function(e){th(e>>>=0,"offset");let t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&tu(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+0x1000000*this[++e])}),eW.prototype.readBigInt64BE=ty(function(e){th(e>>>=0,"offset");let t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&tu(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n)}),eW.prototype.readFloatLE=function(e,t){return e>>>=0,t||e7(e,4,this.length),m(this,e,!0,23,4)},eW.prototype.readFloatBE=function(e,t){return e>>>=0,t||e7(e,4,this.length),m(this,e,!1,23,4)},eW.prototype.readDoubleLE=function(e,t){return e>>>=0,t||e7(e,8,this.length),m(this,e,!0,52,8)},eW.prototype.readDoubleBE=function(e,t){return e>>>=0,t||e7(e,8,this.length),m(this,e,!1,52,8)},eW.prototype.writeUintLE=eW.prototype.writeUIntLE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){let r=Math.pow(2,8*n)-1;e9(this,e,t,n,r,0)}let i=1,s=0;for(this[t]=255&e;++s<n&&(i*=256);)this[t+s]=e/i&255;return t+n},eW.prototype.writeUintBE=eW.prototype.writeUIntBE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){let r=Math.pow(2,8*n)-1;e9(this,e,t,n,r,0)}let i=n-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+n},eW.prototype.writeUint8=eW.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||e9(this,e,t,1,255,0),this[t]=255&e,t+1},eW.prototype.writeUint16LE=eW.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||e9(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},eW.prototype.writeUint16BE=eW.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||e9(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},eW.prototype.writeUint32LE=eW.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||e9(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},eW.prototype.writeUint32BE=eW.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||e9(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},eW.prototype.writeBigUInt64LE=ty(function(e,t=0){return te(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),eW.prototype.writeBigUInt64BE=ty(function(e,t=0){return tt(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),eW.prototype.writeIntLE=function(e,t,n,r){if(e*=1,t>>>=0,!r){let r=Math.pow(2,8*n-1);e9(this,e,t,n,r-1,-r)}let i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s|0)-a&255;return t+n},eW.prototype.writeIntBE=function(e,t,n,r){if(e*=1,t>>>=0,!r){let r=Math.pow(2,8*n-1);e9(this,e,t,n,r-1,-r)}let i=n-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s|0)-a&255;return t+n},eW.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||e9(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},eW.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||e9(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},eW.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||e9(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},eW.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||e9(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},eW.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||e9(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},eW.prototype.writeBigInt64LE=ty(function(e,t=0){return te(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),eW.prototype.writeBigInt64BE=ty(function(e,t=0){return tt(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),eW.prototype.writeFloatLE=function(e,t,n){return tr(this,e,t,!0,n)},eW.prototype.writeFloatBE=function(e,t,n){return tr(this,e,t,!1,n)},eW.prototype.writeDoubleLE=function(e,t,n){return ti(this,e,t,!0,n)},eW.prototype.writeDoubleBE=function(e,t,n){return ti(this,e,t,!1,n)},eW.prototype.copy=function(e,t,n,r){if(!eW.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);let i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},eW.prototype.fill=function(e,t,n,r){let i;if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!eW.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){let t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{let s=eW.isBuffer(e)?e:eW.from(e,r),a=s.length;if(0===a)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};const ts={};function ta(e,t,n){ts[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function to(e){let t="",n=e.length,r=+("-"===e[0]);for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function tl(e,t,n,r,i,s){if(e>n||e<t){let r,i="bigint"==typeof t?"n":"";throw r=s>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${(s+1)*8}${i}`:`>= -(2${i} ** ${(s+1)*8-1}${i}) and < 2 ** ${(s+1)*8-1}${i}`:`>= ${t}${i} and <= ${n}${i}`,new ts.ERR_OUT_OF_RANGE("value",r,e)}th(i,"offset"),(void 0===r[i]||void 0===r[i+s])&&tu(i,r.length-(s+1))}function th(e,t){if("number"!=typeof e)throw new ts.ERR_INVALID_ARG_TYPE(t,"number",e)}function tu(e,t,n){if(Math.floor(e)!==e)throw th(e,n),new ts.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new ts.ERR_BUFFER_OUT_OF_BOUNDS;throw new ts.ERR_OUT_OF_RANGE(n||"offset",`>= ${+!!n} and <= ${t}`,e)}ta("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ta("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),ta("ERR_OUT_OF_RANGE",function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>0x100000000?i=to(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=to(i)),i+="n"),r+=` It must be ${t}. Received ${i}`},RangeError);const tc=/[^+/0-9A-Za-z-_]/g;function tf(e,t){let n;t=t||1/0;let r=e.length,i=null,s=[];for(let a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319||a+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function td(e){return function(e){var t,n,r=function(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}(e),i=r[0],s=r[1],a=new eq((i+s)*3/4-s),o=0,l=s>0?i-4:i;for(n=0;n<l;n+=4)t=e$[e.charCodeAt(n)]<<18|e$[e.charCodeAt(n+1)]<<12|e$[e.charCodeAt(n+2)]<<6|e$[e.charCodeAt(n+3)],a[o++]=t>>16&255,a[o++]=t>>8&255,a[o++]=255&t;return 2===s&&(t=e$[e.charCodeAt(n)]<<2|e$[e.charCodeAt(n+1)]>>4,a[o++]=255&t),1===s&&(t=e$[e.charCodeAt(n)]<<10|e$[e.charCodeAt(n+1)]<<4|e$[e.charCodeAt(n+2)]>>2,a[o++]=t>>8&255,a[o++]=255&t),a}(function(e){if((e=(e=e.split("=")[0]).trim().replace(tc,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function tp(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function tg(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}const tm=function(){let e="0123456789abcdef",t=Array(256);for(let n=0;n<16;++n){let r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function ty(e){return"undefined"==typeof BigInt?tv:e}function tv(){throw Error("BigInt not supported")}const tw="@firebase/firestore",tb="4.9.1";class tE{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tE.UNAUTHENTICATED=new tE(null),tE.GOOGLE_CREDENTIALS=new tE("google-credentials-uid"),tE.FIRST_PARTY=new tE("first-party-uid"),tE.MOCK_USER=new tE("mock-user");let tT="12.2.0";const t_=new Z("@firebase/firestore");function tI(){return t_.logLevel}function tS(e,...t){if(t_.logLevel<=i.DEBUG){let n=t.map(tD);t_.debug(`Firestore (${tT}): ${e}`,...n)}}function tC(e,...t){if(t_.logLevel<=i.ERROR){let n=t.map(tD);t_.error(`Firestore (${tT}): ${e}`,...n)}}function tA(e,...t){if(t_.logLevel<=i.WARN){let n=t.map(tD);t_.warn(`Firestore (${tT}): ${e}`,...n)}}function tD(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function tx(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,tN(e,r,n)}function tN(e,t,n){let r=`FIRESTORE (${tT}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw tC(r),Error(r)}function tk(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||tN(t,i,r)}const tR={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class tL extends U{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class tO{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class tM{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tE.UNAUTHENTICATED))}shutdown(){}}class tV{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class tU{constructor(e){this.t=e,this.currentUser=tE.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){tk(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new tO;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new tO,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{tS("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(tS("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new tO)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(tS("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(tk("string"==typeof t.accessToken,31837,{l:t}),new tM(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return tk(null===e||"string"==typeof e,2055,{h:e}),new tE(e)}}class tF{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=tE.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class tB{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new tF(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(tE.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class tj{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class t${constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,null!=e&&void 0!==e.settings&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){tk(void 0===this.o,3512);let n=e=>{null!=e.error&&tS("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,tS("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{tS("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):tS("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new tj(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(tk("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new tj(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class tq{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function tz(e,t){return e<t?-1:+(e>t)}function tG(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.charAt(r),i=t.charAt(r);if(n!==i)return tH(n)===tH(i)?tz(n,i):tH(n)?1:-1}return tz(e.length,t.length)}function tH(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function tK(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}const tQ="__name__";class tW{constructor(e,t,n){void 0===t?t=0:t>e.length&&tx(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&tx(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===tW.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof tW?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=tW.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return tz(e.length,t.length)}static compareSegments(e,t){let n=tW.isNumericId(e),r=tW.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?tW.extractNumericId(e).compare(tW.extractNumericId(t)):tG(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return s.fromString(e.substring(4,e.length-2))}}class tX extends tW{construct(e,t,n){return new tX(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new tL(tR.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new tX(t)}static emptyPath(){return new tX([])}}const tY=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class tJ extends tW{construct(e,t,n){return new tJ(e,t,n)}static isValidIdentifier(e){return tY.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),tJ.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===tQ}static keyField(){return new tJ([tQ])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new tL(tR.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new tL(tR.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new tL(tR.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new tL(tR.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new tJ(t)}static emptyPath(){return new tJ([])}}class tZ{constructor(e){this.path=e}static fromPath(e){return new tZ(tX.fromString(e))}static fromName(e){return new tZ(tX.fromString(e).popFirst(5))}static empty(){return new tZ(tX.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===tX.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return tX.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new tZ(new tX(e.slice()))}}function t0(e,t,n){if(!n)throw new tL(tR.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function t1(e){if(!tZ.isDocumentKey(e))throw new tL(tR.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function t2(e){if(tZ.isDocumentKey(e))throw new tL(tR.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function t6(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function t3(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":tx(12329,{type:typeof e})}function t5(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new tL(tR.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=t3(e);throw new tL(tR.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function t4(e,t){let n={typeString:e};return t&&(n.value=t),n}function t8(e,t){let n;if(!t6(e))throw new tL(tR.INVALID_ARGUMENT,"JSON must be an object");for(let r in t)if(t[r]){let i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}let a=e[r];if(i&&typeof a!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new tL(tR.INVALID_ARGUMENT,n);return!0}class t7{static now(){return t7.fromMillis(Date.now())}static fromDate(e){return t7.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new t7(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new tL(tR.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new tL(tR.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?tz(this.nanoseconds,e.nanoseconds):tz(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:t7._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(t8(e,t7._jsonSchema))return new t7(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}t7._jsonSchemaVersion="firestore/timestamp/1.0",t7._jsonSchema={type:t4("string",t7._jsonSchemaVersion),seconds:t4("number"),nanoseconds:t4("number")};class t9{static fromTimestamp(e){return new t9(e)}static min(){return new t9(new t7(0,0))}static max(){return new t9(new t7(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ne{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ne(t9.min(),tZ.empty(),-1)}static max(){return new ne(t9.max(),tZ.empty(),-1)}}class nt{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function nn(e){if(e.code!==tR.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;tS("LocalStore","Unexpectedly lost primary lease")}class nr{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&tx(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new nr((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof nr?t:nr.resolve(t)}catch(e){return nr.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):nr.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):nr.reject(t)}static resolve(e){return new nr((t,n)=>{t(e)})}static reject(e){return new nr((t,n)=>{n(e)})}static waitFor(e){return new nr((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=nr.resolve(!1);for(let n of e)t=t.next(e=>e?nr.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new nr((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new nr((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function ni(e){return"IndexedDbTransactionError"===e.name}class ns{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}ns.ce=-1;function na(e){return 0===e&&1/e==-1/0}function no(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function nl(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function nh(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class nu{constructor(e,t){this.comparator=e,this.root=t||nf.EMPTY}insert(e,t){return new nu(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nf.BLACK,null,null))}remove(e){return new nu(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nf.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nc(this.root,e,this.comparator,!1)}getReverseIterator(){return new nc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nc(this.root,e,this.comparator,!0)}}class nc{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nf{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:nf.RED,this.left=null!=r?r:nf.EMPTY,this.right=null!=i?i:nf.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new nf(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return nf.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return nf.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,nf.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,nf.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw tx(43730,{key:this.key,value:this.value});if(this.right.isRed())throw tx(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw tx(27949);return e+ +!this.isRed()}}nf.EMPTY=null,nf.RED=!0,nf.BLACK=!1,nf.EMPTY=new class{constructor(){this.size=0}get key(){throw tx(57766)}get value(){throw tx(16141)}get color(){throw tx(16727)}get left(){throw tx(29726)}get right(){throw tx(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new nf(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class nd{constructor(e){this.comparator=e,this.data=new nu(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new np(this.data.getIterator())}getIteratorFrom(e){return new np(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof nd)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new nd(this.comparator);return t.data=e,t}}class np{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ng{constructor(e){this.fields=e,e.sort(tJ.comparator)}static empty(){return new ng([])}unionWith(e){let t=new nd(tJ.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new ng(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return tK(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class nm extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ny{constructor(e){this.binaryString=e}static fromBase64String(e){return new ny(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new nm("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new ny(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return tz(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ny.EMPTY_BYTE_STRING=new ny("");const nv=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nw(e){if(tk(!!e,39018),"string"==typeof e){let t=0,n=nv.exec(e);if(tk(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:nb(e.seconds),nanos:nb(e.nanos)}}function nb(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function nE(e){return"string"==typeof e?ny.fromBase64String(e):ny.fromUint8Array(e)}const nT="server_timestamp",n_="__type__",nI="__previous_value__",nS="__local_write_time__";function nC(e){return(e?.mapValue?.fields||{})[n_]?.stringValue===nT}function nA(e){let t=e.mapValue.fields[nI];return nC(t)?nA(t):t}function nD(e){let t=nw(e.mapValue.fields[nS].timestampValue);return new t7(t.seconds,t.nanos)}class nx{constructor(e,t,n,r,i,s,a,o,l,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=h}}const nN="(default)";class nk{constructor(e,t){this.projectId=e,this.database=t||nN}static empty(){return new nk("","")}get isDefaultDatabase(){return this.database===nN}isEqual(e){return e instanceof nk&&e.projectId===this.projectId&&e.database===this.database}}const nR="__type__",nL="__max__",nO={},nM="__vector__",nP="value";function nV(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?nC(e)?4:nY(e)?0x1fffffffffffff:nW(e)?10:11:tx(28295,{value:e})}function nU(e,t){if(e===t)return!0;let n=nV(e);if(n!==nV(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return nD(e).isEqual(nD(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=nw(e.timestampValue),i=nw(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return nE(e.bytesValue).isEqual(nE(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return nb(e.geoPointValue.latitude)===nb(t.geoPointValue.latitude)&&nb(e.geoPointValue.longitude)===nb(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return nb(e.integerValue)===nb(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=nb(e.doubleValue),r=nb(t.doubleValue);return n===r?na(n)===na(r):isNaN(n)&&isNaN(r)}return!1;case 9:return tK(e.arrayValue.values||[],t.arrayValue.values||[],nU);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(no(s)!==no(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!nU(s[e],a[e])))return!1;return!0;default:return tx(52216,{left:e})}}function nF(e,t){return void 0!==(e.values||[]).find(e=>nU(e,t))}function nB(e,t){if(e===t)return 0;let n=nV(e),r=nV(t);if(n!==r)return tz(n,r);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return tz(e.booleanValue,t.booleanValue);case 2:let i=nb(e.integerValue||e.doubleValue),s=nb(t.integerValue||t.doubleValue);return i<s?-1:i>s?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return nj(e.timestampValue,t.timestampValue);case 4:return nj(nD(e),nD(t));case 5:return tG(e.stringValue,t.stringValue);case 6:return function(e,t){let n=nE(e),r=nE(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=tz(n[e],r[e]);if(0!==t)return t}return tz(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=tz(nb(e.latitude),nb(t.latitude));return 0!==n?n:tz(nb(e.longitude),nb(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return n$(e.arrayValue,t.arrayValue);case 10:return function(e,t){let n=e.fields||{},r=t.fields||{},i=n[nP]?.arrayValue,s=r[nP]?.arrayValue,a=tz(i?.values?.length||0,s?.values?.length||0);return 0!==a?a:n$(i,s)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===nO&&t===nO)return 0;if(e===nO)return 1;if(t===nO)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=tG(r[e],s[e]);if(0!==t)return t;let a=nB(n[r[e]],i[s[e]]);if(0!==a)return a}return tz(r.length,s.length)}(e.mapValue,t.mapValue);default:throw tx(23264,{he:n})}}function nj(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return tz(e,t);let n=nw(e),r=nw(t),i=tz(n.seconds,r.seconds);return 0!==i?i:tz(n.nanos,r.nanos)}function n$(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=nB(n[e],r[e]);if(t)return t}return tz(n.length,r.length)}function nq(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=nw(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?nE(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,tZ.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=nq(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${nq(e.fields[i])}`;return n+"}"}(e.mapValue):tx(61005,{value:e})}function nz(e){return!!e&&"integerValue"in e}function nG(e){return!!e&&"arrayValue"in e}function nH(e){return!!e&&"nullValue"in e}function nK(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function nQ(e){return!!e&&"mapValue"in e}function nW(e){return(e?.mapValue?.fields||{})[nR]?.stringValue===nM}function nX(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return nl(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=nX(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=nX(e.arrayValue.values[n]);return t}return{...e}}function nY(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===nL}class nJ{constructor(e){this.value=e}static empty(){return new nJ({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!nQ(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=nX(t)}setAll(e){let t=tJ.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=nX(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());nQ(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nU(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];nQ(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(nl(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new nJ(nX(this.value))}}class nZ{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new nZ(e,0,t9.min(),t9.min(),t9.min(),nJ.empty(),0)}static newFoundDocument(e,t,n,r){return new nZ(e,1,t,t9.min(),n,r,0)}static newNoDocument(e,t){return new nZ(e,2,t,t9.min(),t9.min(),nJ.empty(),0)}static newUnknownDocument(e,t){return new nZ(e,3,t,t9.min(),t9.min(),nJ.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(t9.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nJ.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nJ.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=t9.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof nZ&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new nZ(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class n0{constructor(e,t){this.position=e,this.inclusive=t}}function n1(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?tZ.comparator(tZ.fromName(a.referenceValue),n.key):nB(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function n2(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!nU(e.position[n],t.position[n]))return!1;return!0}class n6{constructor(e,t="asc"){this.field=e,this.dir=t}}class n3{}class n5 extends n3{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new n9(e,t,n):"array-contains"===t?new rr(e,n):"in"===t?new ri(e,n):"not-in"===t?new rs(e,n):"array-contains-any"===t?new ra(e,n):new n5(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new re(e,n):new rt(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(nB(t,this.value)):null!==t&&nV(this.value)===nV(t)&&this.matchesComparison(nB(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return tx(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class n4 extends n3{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new n4(e,t)}matches(e){return n8(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function n8(e){return"and"===e.op}function n7(e){for(let t of e.filters)if(t instanceof n4)return!1;return!0}class n9 extends n5{constructor(e,t,n){super(e,t,n),this.key=tZ.fromName(n.referenceValue)}matches(e){let t=tZ.comparator(e.key,this.key);return this.matchesComparison(t)}}class re extends n5{constructor(e,t){super(e,"in",t),this.keys=rn("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class rt extends n5{constructor(e,t){super(e,"not-in",t),this.keys=rn("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function rn(e,t){return(t.arrayValue?.values||[]).map(e=>tZ.fromName(e.referenceValue))}class rr extends n5{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return nG(t)&&nF(t.arrayValue,this.value)}}class ri extends n5{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&nF(this.value.arrayValue,t)}}class rs extends n5{constructor(e,t){super(e,"not-in",t)}matches(e){if(nF(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!nF(this.value.arrayValue,t)}}class ra extends n5{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!nG(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>nF(this.value.arrayValue,e))}}class ro{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function rl(e,t=null,n=[],r=[],i=null,s=null,a=null){return new ro(e,t,n,r,i,s,a)}function rh(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof n5)return t.field.canonicalString()+t.op.toString()+nq(t.value);if(n7(t)&&n8(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>nq(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>nq(e)).join(",")),e.Te=t}return e.Te}function ru(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof n5?n instanceof n5&&t.op===n.op&&t.field.isEqual(n.field)&&nU(t.value,n.value):t instanceof n4?n instanceof n4&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void tx(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!n2(e.startAt,t.startAt)&&n2(e.endAt,t.endAt)}function rc(e){return tZ.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class rf{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function rd(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function rp(e){if(null===e.Ie){let t;e.Ie=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new nd(tJ.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new n6(t,r))}),n.has(tJ.keyField().canonicalString())||e.Ie.push(new n6(tJ.keyField(),r))}return e.Ie}function rg(e){return e.Ee||(e.Ee=function(e,t){if("F"===e.limitType)return rl(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new n6(e.field,t)});let n=e.endAt?new n0(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new n0(e.startAt.position,e.startAt.inclusive):null;return rl(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(e,rp(e))),e.Ee}function rm(e,t,n){return new rf(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ry(e,t){return ru(rg(e),rg(t))&&e.limitType===t.limitType}function rv(e){return`${rh(rg(e))}|lt:${e.limitType}`}function rw(e){var t;let n;return`Query(target=${n=(t=rg(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof n5?`${t.field.canonicalString()} ${t.op} ${nq(t.value)}`:t instanceof n4?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>nq(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>nq(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function rb(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):tZ.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of rp(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,n){let r=n1(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,rp(e),t))&&(!e.endAt||!!function(e,t,n){let r=n1(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,rp(e),t))}function rE(e){return(t,n)=>{let r=!1;for(let i of rp(e)){let e=function(e,t,n){let r=e.field.isKeyField()?tZ.comparator(t.key,n.key):function(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?nB(r,i):tx(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return tx(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class rT{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){nl(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return nh(this.inner)}size(){return this.innerSize}}const r_=new nu(tZ.comparator),rI=new nu(tZ.comparator);function rS(...e){let t=rI;for(let n of e)t=t.insert(n.key,n);return t}function rC(e){let t=rI;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function rA(){return new rT(e=>e.toString(),(e,t)=>e.isEqual(t))}const rD=new nu(tZ.comparator),rx=new nd(tZ.comparator);function rN(...e){let t=rx;for(let n of e)t=t.add(n);return t}const rk=new nd(tz);function rR(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:na(t)?"-0":t}}function rL(e){return{integerValue:""+e}}class rO{constructor(){this._=void 0}}function rM(e,t){return e instanceof rj?nz(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class rP extends rO{}class rV extends rO{constructor(e){super(),this.elements=e}}function rU(e,t){let n=rq(t);for(let t of e.elements)n.some(e=>nU(e,t))||n.push(t);return{arrayValue:{values:n}}}class rF extends rO{constructor(e){super(),this.elements=e}}function rB(e,t){let n=rq(t);for(let t of e.elements)n=n.filter(e=>!nU(e,t));return{arrayValue:{values:n}}}class rj extends rO{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function r$(e){return nb(e.integerValue||e.doubleValue)}function rq(e){return nG(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class rz{constructor(e,t){this.field=e,this.transform=t}}class rG{constructor(e,t){this.version=e,this.transformResults=t}}class rH{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new rH}static exists(e){return new rH(void 0,e)}static updateTime(e){return new rH(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rK(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class rQ{}function rW(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new r6(e.key,rH.none()):new rJ(e.key,e.data,rH.none());{let n=e.data,r=nJ.empty(),i=new nd(tJ.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new rZ(e.key,r,new ng(i.toArray()),rH.none())}}function rX(e,t,n,r){return e instanceof rJ?function(e,t,n,r){if(!rK(e.precondition,t))return n;let i=e.value.clone(),s=r2(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof rZ?function(e,t,n,r){if(!rK(e.precondition,t))return n;let i=r2(e.fieldTransforms,r,t),s=t.data;return(s.setAll(r0(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):rK(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function rY(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&tK(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof rV&&r instanceof rV||n instanceof rF&&r instanceof rF?tK(n.elements,r.elements,nU):n instanceof rj&&r instanceof rj?nU(n.Ae,r.Ae):n instanceof rP&&r instanceof rP)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class rJ extends rQ{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class rZ extends rQ{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function r0(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function r1(e,t,n){let r=new Map;tk(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let s=0;s<n.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);r.set(a.field,(i=n[s],o instanceof rV?rU(o,l):o instanceof rF?rB(o,l):i))}return r}function r2(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,e instanceof rP?function(e,t){let n={fields:{[n_]:{stringValue:nT},[nS]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&nC(t)&&(t=nA(t)),t&&(n.fields[nI]=t),{mapValue:n}}(t,s):e instanceof rV?rU(e,s):e instanceof rF?rB(e,s):function(e,t){let n=rM(e,t),r=r$(n)+r$(e.Ae);return nz(n)&&nz(e.Ae)?rL(r):rR(e.serializer,r)}(e,s))}return r}class r6 extends rQ{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class r3 extends rQ{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class r5{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){e instanceof rJ?function(e,t,n){let r=e.value.clone(),i=r1(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof rZ?function(e,t,n){if(!rK(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=r1(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(r0(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=rX(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=rX(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=rA();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=rW(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(t9.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),rN())}isEqual(e){return this.batchId===e.batchId&&tK(this.mutations,e.mutations,(e,t)=>rY(e,t))&&tK(this.baseMutations,e.baseMutations,(e,t)=>rY(e,t))}}class r4{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){tk(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=rD,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new r4(e,t,n,r)}}class r8{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class r7{constructor(e,t){this.count=e,this.unchangedNames=t}}function r9(e){if(void 0===e)return tC("GRPC error has no .code"),tR.UNKNOWN;switch(e){case v.OK:return tR.OK;case v.CANCELLED:return tR.CANCELLED;case v.UNKNOWN:return tR.UNKNOWN;case v.DEADLINE_EXCEEDED:return tR.DEADLINE_EXCEEDED;case v.RESOURCE_EXHAUSTED:return tR.RESOURCE_EXHAUSTED;case v.INTERNAL:return tR.INTERNAL;case v.UNAVAILABLE:return tR.UNAVAILABLE;case v.UNAUTHENTICATED:return tR.UNAUTHENTICATED;case v.INVALID_ARGUMENT:return tR.INVALID_ARGUMENT;case v.NOT_FOUND:return tR.NOT_FOUND;case v.ALREADY_EXISTS:return tR.ALREADY_EXISTS;case v.PERMISSION_DENIED:return tR.PERMISSION_DENIED;case v.FAILED_PRECONDITION:return tR.FAILED_PRECONDITION;case v.ABORTED:return tR.ABORTED;case v.OUT_OF_RANGE:return tR.OUT_OF_RANGE;case v.UNIMPLEMENTED:return tR.UNIMPLEMENTED;case v.DATA_LOSS:return tR.DATA_LOSS;default:return tx(39323,{code:e})}}(w=v||(v={}))[w.OK=0]="OK",w[w.CANCELLED=1]="CANCELLED",w[w.UNKNOWN=2]="UNKNOWN",w[w.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",w[w.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",w[w.NOT_FOUND=5]="NOT_FOUND",w[w.ALREADY_EXISTS=6]="ALREADY_EXISTS",w[w.PERMISSION_DENIED=7]="PERMISSION_DENIED",w[w.UNAUTHENTICATED=16]="UNAUTHENTICATED",w[w.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",w[w.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",w[w.ABORTED=10]="ABORTED",w[w.OUT_OF_RANGE=11]="OUT_OF_RANGE",w[w.UNIMPLEMENTED=12]="UNIMPLEMENTED",w[w.INTERNAL=13]="INTERNAL",w[w.UNAVAILABLE=14]="UNAVAILABLE",w[w.DATA_LOSS=15]="DATA_LOSS";const ie=new s([0xffffffff,0xffffffff],0);function it(e){let t=(new TextEncoder).encode(e),n=new a;return n.update(t),new Uint8Array(n.digest())}function ir(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new s([n,r],0),new s([i,a],0)]}class ii{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new is(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new is(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new is(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=s.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(s.fromNumber(n)));return 1===r.compare(ie)&&(r=new s([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,n]=ir(it(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);if(!this.we(r))return!1}return!0}static create(e,t,n){let r=new ii(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.ge)return;let[t,n]=ir(it(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);this.Se(r)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class is extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ia{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,io.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ia(t9.min(),r,new nu(tz),r_,rN())}}class io{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new io(n,t,rN(),rN(),rN())}}class il{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class ih{constructor(e,t){this.targetId=e,this.Ce=t}}class iu{constructor(e,t,n=ny.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class ic{constructor(){this.ve=0,this.Fe=ig(),this.Me=ny.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=rN(),t=rN(),n=rN();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:tx(38017,{changeType:i})}}),new io(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=ig()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,tk(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class id{constructor(e){this.Ge=e,this.ze=new Map,this.je=r_,this.Je=ip(),this.He=ip(),this.Ye=new nu(tz)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:tx(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){let t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){let i=r.target;if(rc(i))if(0===n){let e=new tZ(i.path);this.et(t,e,nZ.newNoDocument(e,t9.min()))}else tk(1===n,20013,{expectedCount:n});else{let r=this._t(t);if(r!==n){let n=this.ut(e),i=n?this.ct(n,e,r):1;0!==i&&(this.it(t),this.Ye=this.Ye.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ut(e){let t,n,r=e.Ce.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=nE(i).toUint8Array()}catch(e){if(e instanceof nm)return tA("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new ii(t,s,a)}catch(e){return tA(e instanceof is?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.ge?null:n}ct(e,t,n){return 2*(t.Ce.count!==n-this.Pt(e,t.targetId))}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.et(t,n,null),r++)}),r}Tt(e){let t=new Map;this.ze.forEach((n,r)=>{let i=this.ot(r);if(i){if(n.current&&rc(i.target)){let t=new tZ(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,nZ.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}});let n=rN();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));let r=new ia(e,t,this.Ye,this.je,n);return this.je=r_,this.Je=ip(),this.He=ip(),this.Ye=new nu(tz),r}Xe(e,t){if(!this.rt(e))return;let n=2*!!this.Et(e,t.key);this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new ic,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new nd(tz),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new nd(tz),this.Je=this.Je.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||tS("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ic),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ip(){return new nu(tZ.comparator)}function ig(){return new nu(tZ.comparator)}const im={asc:"ASCENDING",desc:"DESCENDING"},iy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iv={and:"AND",or:"OR"};class iw{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ib(e,t){return e.useProto3Json||null==t?t:{value:t}}function iE(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function iT(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function i_(e){return tk(!!e,49232),t9.fromTimestamp(function(e){let t=nw(e);return new t7(t.seconds,t.nanos)}(e))}function iI(e,t){return iS(e,t).canonicalString()}function iS(e,t){let n=new tX(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function iC(e){let t=tX.fromString(e);return tk(iM(t),10190,{key:t.toString()}),t}function iA(e,t){return iI(e.databaseId,t.path)}function iD(e,t){let n=iC(t);if(n.get(1)!==e.databaseId.projectId)throw new tL(tR.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new tL(tR.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new tZ(ik(n))}function ix(e,t){return iI(e.databaseId,t)}function iN(e){return new tX(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ik(e){return tk(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function iR(e,t,n){return{name:iA(e,t),fields:n.value.mapValue.fields}}function iL(e){return{fieldPath:e.canonicalString()}}function iO(e){return tJ.fromServerFormat(e.fieldPath)}function iM(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class iP{constructor(e,t,n,r,i=t9.min(),s=t9.min(),a=ny.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new iP(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new iP(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new iP(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new iP(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class iV{constructor(e){this.yt=e}}class iU{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(nb(e.integerValue));else if("doubleValue"in e){let n=nb(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),na(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=nw(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(nE(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?nY(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):nW(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):tx(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let n=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(n)))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){let n=e.fields||{};this.Ft(t,53);let r=n[nP].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(nb(r)),this.Ot(nP,t),this.Ct(n[nP],t)}Qt(e,t){let n=e.values||[];for(let e of(this.Ft(t,50),n))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),tZ.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}iU.Kt=new iU;class iF{constructor(){this.Cn=new iB}addToCollectionParentIndex(e,t){return this.Cn.add(t),nr.resolve()}getCollectionParents(e,t){return nr.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return nr.resolve()}deleteFieldIndex(e,t){return nr.resolve()}deleteAllFieldIndexes(e){return nr.resolve()}createTargetIndexes(e,t){return nr.resolve()}getDocumentsMatchingTarget(e,t){return nr.resolve(null)}getIndexType(e,t){return nr.resolve(0)}getFieldIndexes(e,t){return nr.resolve([])}getNextCollectionGroupToUpdate(e){return nr.resolve(null)}getMinOffset(e,t){return nr.resolve(ne.min())}getMinOffsetFromCollectionGroup(e,t){return nr.resolve(ne.min())}updateCollectionGroup(e,t,n){return nr.resolve()}updateIndexEntries(e,t){return nr.resolve()}}class iB{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new nd(tX.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new nd(tX.comparator)).toArray()}}new Uint8Array(0);const ij={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class i${static withCacheSize(e){return new i$(e,i$.DEFAULT_COLLECTION_PERCENTILE,i$.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}i$.DEFAULT_COLLECTION_PERCENTILE=10,i$.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,i$.DEFAULT=new i$(0x2800000,i$.DEFAULT_COLLECTION_PERCENTILE,i$.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),i$.DISABLED=new i$(-1,0,0);class iq{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new iq(0)}static cr(){return new iq(-1)}}const iz="LruGarbageCollector";function iG([e,t],[n,r]){let i=tz(e,n);return 0===i?tz(t,r):i}class iH{constructor(e){this.Ir=e,this.buffer=new nd(iG),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>iG(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class iK{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){tS(iz,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ni(e)?tS(iz,"Ignoring IndexedDB error during garbage collection: ",e):await nn(e)}await this.Vr(3e5)})}}class iQ{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return nr.resolve(ns.ce);let n=new iH(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(tS("LruGarbageCollector","Garbage collection skipped; disabled"),nr.resolve(ij)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(tS("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ij):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,s,a,o,l,h,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(tS("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(s=t,l=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(h=Date.now(),tI()<=i.DEBUG&&tS("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-u}ms
	Determined least recently used ${r} in `+(o-a)+"ms\n"+`	Removed ${s} targets in `+(l-o)+"ms\n"+`	Removed ${e} documents in `+(h-l)+"ms\n"+`Total Duration: ${h-u}ms`),nr.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:e})))}}class iW{constructor(){this.changes=new rT(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,nZ.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?nr.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class iX{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class iY{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&rX(n.mutation,e,ng.empty(),t7.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,rN()).next(()=>t))}getLocalViewOfDocuments(e,t,n=rN()){let r=rA();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=rS();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=rA();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,rN()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=r_,s=rA(),a=rA();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof rZ)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),rX(a.mutation,t,a.mutation.getFieldMask(),t7.now())):s.set(t.key,ng.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new iX(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let n=rA(),r=new nu((e,t)=>e-t),i=rN();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||ng.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||rN()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,h=rA();l.forEach(e=>{if(!i.has(e)){let r=rW(t.get(e),n.get(e));null!==r&&h.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,h))}return nr.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return tZ.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):null!==t.collectionGroup?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):nr.resolve(rA()),a=-1,o=i;return s.next(t=>nr.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?nr.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,rN())).next(e=>({batchId:a,changes:rC(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new tZ(t)).next(e=>{let t=rS();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=rS();return this.indexManager.getCollectionParents(e,i).next(a=>nr.forEach(a,a=>{let o=new rf(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,nZ.newInvalidDocument(r)))});let n=rS();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&rX(s.mutation,r,ng.empty(),t7.now()),rb(t,r)&&(n=n.insert(e,r))}),n})}}class iJ{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return nr.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:t.id,version:t.version,createTime:i_(t.createTime)}),nr.resolve()}getNamedQuery(e,t){return nr.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:t.name,query:function(e){let t=function(e){var t;let n,r=function(e){let t=iC(e);return 4===t.length?tX.emptyPath():ik(t)}(e.parent),i=e.structuredQuery,s=i.from?i.from.length:0,a=null;if(s>0){tk(1===s,65062);let e=i.from[0];e.allDescendants?a=e.collectionId:r=r.child(e.collectionId)}let o=[];i.where&&(o=function(e){var t;let n=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=iO(e.unaryFilter.field);return n5.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=iO(e.unaryFilter.field);return n5.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=iO(e.unaryFilter.field);return n5.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=iO(e.unaryFilter.field);return n5.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return tx(61313);default:return tx(60726)}}(t):void 0!==t.fieldFilter?n5.create(iO(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return tx(58110);default:return tx(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?n4.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return tx(1026)}}(t.compositeFilter.op)):tx(30097,{filter:t})}(e);return n instanceof n4&&n7(t=n)&&n8(t)?n.getFilters():[n]}(i.where));let l=[];i.orderBy&&(l=i.orderBy.map(e=>new n6(iO(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let h=null;i.limit&&(h=null==(n="object"==typeof(t=i.limit)?t.value:t)?null:n);let u=null;i.startAt&&(u=function(e){let t=!!e.before;return new n0(e.values||[],t)}(i.startAt));let c=null;return i.endAt&&(c=function(e){let t=!e.before;return new n0(e.values||[],t)}(i.endAt)),new rf(r,a,l,o,h,"F",u,c)}({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?rm(t,t.limit,"L"):t}(t.bundledQuery),readTime:i_(t.readTime)}),nr.resolve()}}class iZ{constructor(){this.overlays=new nu(tZ.comparator),this.qr=new Map}getOverlay(e,t){return nr.resolve(this.overlays.get(t))}getOverlays(e,t){let n=rA();return nr.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),nr.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),nr.resolve()}getOverlaysForCollection(e,t,n){let r=rA(),i=t.length+1,s=new tZ(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return nr.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new nu((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=rA(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=rA(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return nr.resolve(a)}St(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new r8(t,n));let i=this.qr.get(t);void 0===i&&(i=rN(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}}class i0{constructor(){this.sessionToken=ny.EMPTY_BYTE_STRING}getSessionToken(e){return nr.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,nr.resolve()}}class i1{constructor(){this.Qr=new nd(i2.$r),this.Ur=new nd(i2.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let n=new i2(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new i2(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){let t=new tZ(new tX([])),n=new i2(t,e),r=new i2(t,e+1),i=[];return this.Ur.forEachInRange([n,r],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new tZ(new tX([])),n=new i2(t,e),r=new i2(t,e+1),i=rN();return this.Ur.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new i2(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class i2{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return tZ.comparator(e.key,t.key)||tz(e.Yr,t.Yr)}static Kr(e,t){return tz(e.Yr,t.Yr)||tZ.comparator(e.key,t.key)}}class i6{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new nd(i2.$r)}checkEmpty(e){return nr.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new r5(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Zr=this.Zr.add(new i2(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return nr.resolve(s)}lookupMutationBatch(e,t){return nr.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.ei(t+1),r=n<0?0:n;return nr.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return nr.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return nr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new i2(t,0),r=new i2(t,1/0),i=[];return this.Zr.forEachInRange([n,r],e=>{let t=this.Xr(e.Yr);i.push(t)}),nr.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new nd(tz);return t.forEach(e=>{let t=new i2(e,0),r=new i2(e,1/0);this.Zr.forEachInRange([t,r],e=>{n=n.add(e.Yr)})}),nr.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;tZ.isDocumentKey(i)||(i=i.child(""));let s=new i2(new tZ(i),0),a=new nd(tz);return this.Zr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Yr)),!0)},s),nr.resolve(this.ti(a))}ti(e){let t=[];return e.forEach(e=>{let n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){tk(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return nr.forEach(t.mutations,r=>{let i=new i2(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){let n=new i2(t,0),r=this.Zr.firstAfterOrEqual(n);return nr.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,nr.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class i3{constructor(e){this.ri=e,this.docs=new nu(tZ.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return nr.resolve(n?n.document.mutableCopy():nZ.newInvalidDocument(t))}getEntries(e,t){let n=r_;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():nZ.newInvalidDocument(e))}),nr.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=r_,s=t.path,a=new tZ(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=tZ.comparator(e.documentKey,t.documentKey))?n:tz(e.largestBatchId,t.largestBatchId)}(new ne(a.readTime,a.key,-1),n)||(r.has(a.key)||rb(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return nr.resolve(i)}getAllFromCollectionGroup(e,t,n,r){tx(9500)}ii(e,t){return nr.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new i5(this)}getSize(e){return nr.resolve(this.size)}}class i5 extends iW{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),nr.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class i4{constructor(e){this.persistence=e,this.si=new rT(e=>rh(e),ru),this.lastRemoteSnapshotVersion=t9.min(),this.highestTargetId=0,this.oi=0,this._i=new i1,this.targetCount=0,this.ai=iq.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),nr.resolve()}getLastRemoteSnapshotVersion(e){return nr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return nr.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),nr.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),nr.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new iq(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,nr.resolve()}updateTargetData(e,t){return this.Pr(t),nr.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,nr.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.si.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),nr.waitFor(i).next(()=>r)}getTargetCount(e){return nr.resolve(this.targetCount)}getTargetData(e,t){let n=this.si.get(t)||null;return nr.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),nr.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),nr.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),nr.resolve()}getMatchingKeysForTargetId(e,t){let n=this._i.Hr(t);return nr.resolve(n)}containsKey(e,t){return nr.resolve(this._i.containsKey(t))}}class i8{constructor(e,t){this.ui={},this.overlays={},this.ci=new ns(0),this.li=!1,this.li=!0,this.hi=new i0,this.referenceDelegate=e(this),this.Pi=new i4(this),this.indexManager=new iF,this.remoteDocumentCache=new i3(e=>this.referenceDelegate.Ti(e)),this.serializer=new iV(t),this.Ii=new iJ(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new iZ,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new i6(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){tS("MemoryPersistence","Starting transaction:",e);let r=new i7(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return nr.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class i7 extends nt{constructor(e){super(),this.currentSequenceNumber=e}}class i9{constructor(e){this.persistence=e,this.Ri=new i1,this.Vi=null}static mi(e){return new i9(e)}get fi(){if(this.Vi)return this.Vi;throw tx(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),nr.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),nr.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),nr.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nr.forEach(this.fi,n=>{let r=tZ.fromPath(n);return this.gi(e,r).next(e=>{e||t.removeEntry(r,t9.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return nr.or([()=>nr.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class se{constructor(e,t){this.persistence=e,this.pi=new rT(e=>(function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"})(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new iQ(this,t)}static mi(e,t){return new se(e,t)}Ei(){}di(e){return nr.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return nr.forEach(this.pi,(n,r)=>this.br(e,n,r).next(e=>e?nr.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(n++,i.removeEntry(r,t9.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),nr.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),nr.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),nr.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),nr.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(nV(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=nA(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return nE(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,nl(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw tx(13486,{value:t})}}(e.data.value)),t}br(e,t,n){return nr.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.pi.get(t);return nr.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class st{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=rN(),r=rN();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new st(e,t.fromCache,n,r)}}class sn{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class sr{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=!function(){let e=k()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(T.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new sn;return this.Ss(e,t,n).next(r=>{if(i.result=r,this.Vs)return this.bs(e,t,n,r.size)})}).next(()=>i.result)}bs(e,t,n,r){return n.documentReadCount<this.fs?(tI()<=i.DEBUG&&tS("QueryEngine","SDK will not create cache indexes for query:",rw(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),nr.resolve()):(tI()<=i.DEBUG&&tS("QueryEngine","Query:",rw(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(tI()<=i.DEBUG&&tS("QueryEngine","The SDK decides to create cache indexes for query:",rw(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,rg(t))):nr.resolve())}ys(e,t){if(rd(t))return nr.resolve(null);let n=rg(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=rg(t=rm(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=rN(...r);return this.ps.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Ds(t,r);return this.Cs(t,s,i,n.readTime)?this.ys(e,rm(t,null,"F")):this.vs(e,s,t,n)}))})))}ws(e,t,n,r){return rd(t)||r.isEqual(t9.min())?nr.resolve(null):this.ps.getDocuments(e,n).next(s=>{let a=this.Ds(t,s);return this.Cs(t,a,n,r)?nr.resolve(null):(tI()<=i.DEBUG&&tS("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),rw(t)),this.vs(e,a,t,function(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new ne(t9.fromTimestamp(1e9===r?new t7(n+1,0):new t7(n,r)),tZ.empty(),-1)}(r,0)).next(e=>e))})}Ds(e,t){let n=new nd(rE(e));return t.forEach((t,r)=>{rb(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return tI()<=i.DEBUG&&tS("QueryEngine","Using full collection scan to execute query:",rw(t)),this.ps.getDocumentsMatchingQuery(e,t,ne.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const si="LocalStore";class ss{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new nu(tz),this.xs=new rT(e=>rh(e),ru),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new iY(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function sa(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=rN();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:s}))})})}function so(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}async function sl(e,t,n){let r=e.Ms.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!ni(e))throw e;tS(si,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ms=e.Ms.remove(t),e.xs.delete(r.target)}function sh(e,t,n){let r=t9.min(),i=rN();return e.persistence.runTransaction("Execute query","readwrite",s=>(function(e,t,n){let r=e.xs.get(n);return void 0!==r?nr.resolve(e.Ms.get(r)):e.Pi.getTargetData(t,n)})(e,s,rg(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Pi.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Fs.getDocumentsMatchingQuery(s,t,n?r:t9.min(),n?i:rN())).next(n=>{var r,s,a;let o;return r=e,s=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),a=n,o=r.Os.get(s)||t9.min(),a.forEach((e,t)=>{t.readTime.compareTo(o)>0&&(o=t.readTime)}),r.Os.set(s,o),{documents:n,Qs:i}}))}class su{constructor(){this.activeTargetIds=rk}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class sc{constructor(){this.Mo=new su,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new su,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class sf{Oo(e){}shutdown(){}}const sd="ConnectivityMonitor";class sp{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){for(let e of(tS(sd,"Network connectivity changed: AVAILABLE"),this.qo))e(0)}ko(){for(let e of(tS(sd,"Network connectivity changed: UNAVAILABLE"),this.qo))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let sg=null;function sm(){return null===sg?sg=0x10000000+Math.round(0x80000000*Math.random()):sg++,"0x"+sg.toString(16)}const sy="RestConnection",sv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class sw{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===nN?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,t,n,r,i){let s=sm(),a=this.zo(e,t.toUriEncodedString());tS(sy,`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,r,i);let{host:l}=new URL(a),h=O(l);return this.Jo(e,a,o,n,h).then(t=>(tS(sy,`Received RPC '${e}' ${s}: `,t),t),t=>{throw tA(sy,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}Ho(e,t,n,r,i,s){return this.Go(e,t,n,r,i)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+tT,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){let n=sv[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class sb{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const sE="WebChannelConnection";class sT extends sw{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,i){let s=sm();return new Promise((i,a)=>{let l=new o;l.setWithCredentials(!0),l.listenOnce(h.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case u.NO_ERROR:let t=l.getResponseJson();tS(sE,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case u.TIMEOUT:tS(sE,`RPC '${e}' ${s} timed out`),a(new tL(tR.DEADLINE_EXCEEDED,"Request time out"));break;case u.HTTP_ERROR:let n=l.getStatus();if(tS(sE,`RPC '${e}' ${s} failed with status:`,n,"response text:",l.getResponseText()),n>0){let e=l.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(tR).indexOf(t)>=0?t:tR.UNKNOWN}(t.status);a(new tL(e,t.message))}else a(new tL(tR.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new tL(tR.UNAVAILABLE,"Connection failed."));break;default:tx(9055,{l_:e,streamId:s,h_:l.getLastErrorCode(),P_:l.getLastError()})}}finally{tS(sE,`RPC '${e}' ${s} completed.`)}});let c=JSON.stringify(r);tS(sE,`RPC '${e}' ${s} sending request:`,r),l.send(t,"POST",c,n,15)})}T_(e,t,n){let r=sm(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=p(),a=d(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(o.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(o.useFetchStreams=!0),this.jo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;let u=i.join("");tS(sE,`Creating RPC '${e}' stream ${r}: ${u}`,o);let g=s.createWebChannel(u,o);this.I_(g);let m=!1,y=!1,w=new sb({Yo:t=>{y?tS(sE,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(m||(tS(sE,`Opening RPC '${e}' stream ${r} transport.`),g.open(),m=!0),tS(sE,`RPC '${e}' stream ${r} sending:`,t),g.send(t))},Zo:()=>g.close()}),b=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return b(g,l.EventType.OPEN,()=>{y||(tS(sE,`RPC '${e}' stream ${r} transport opened.`),w.o_())}),b(g,l.EventType.CLOSE,()=>{y||(y=!0,tS(sE,`RPC '${e}' stream ${r} transport closed`),w.a_(),this.E_(g))}),b(g,l.EventType.ERROR,t=>{y||(y=!0,tA(sE,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),w.a_(new tL(tR.UNAVAILABLE,"The operation could not be completed")))}),b(g,l.EventType.MESSAGE,t=>{if(!y){let n=t.data[0];tk(!!n,16349);let i=n?.error||n[0]?.error;if(i){tS(sE,`RPC '${e}' stream ${r} received error:`,i);let t=i.status,n=function(e){let t=v[e];if(void 0!==t)return r9(t)}(t),s=i.message;void 0===n&&(n=tR.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),y=!0,w.a_(new tL(n,s)),g.close()}else tS(sE,`RPC '${e}' stream ${r} received:`,n),w.u_(n)}}),b(a,f.STAT_EVENT,t=>{t.stat===c.PROXY?tS(sE,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===c.NOPROXY&&tS(sE,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{w.__()},0),w}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function s_(){return"undefined"!=typeof document?document:null}function sI(e){return new iw(e,!0)}class sS{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&tS("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const sC="PersistentStream";class sA{constructor(e,t,n,r,i,s,a,o){this.Mi=e,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new sS(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===tR.RESOURCE_EXHAUSTED?(tC(t.toString()),tC("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===tR.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{let e=new tL(tR.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return tS(sC,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(tS(sC,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class sD extends sA{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:tx(39313,{state:r}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(tk(void 0===i||"string"==typeof i,58123),ny.fromBase64String(i||"")):(tk(void 0===i||i instanceof eW||i instanceof Uint8Array,16193),ny.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new iu(s,a,o,l&&new tL(void 0===l.code?tR.UNKNOWN:r9(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=iD(e,r.document.name),s=i_(r.document.updateTime),a=r.document.createTime?i_(r.document.createTime):t9.min(),o=new nJ({mapValue:{fields:r.document.fields}}),l=nZ.newFoundDocument(i,s,a,o);n=new il(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=iD(e,r.document),s=r.readTime?i_(r.readTime):t9.min(),a=nZ.newNoDocument(i,s);n=new il([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=iD(e,r.document);n=new il([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return tx(11601,{Rt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new r7(r,i);n=new ih(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return t9.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?t9.min():t.readTime?i_(t.readTime):t9.min()}(e);return this.listener.H_(t,n)}Y_(e){let t={};t.database=iN(this.serializer),t.addTarget=function(e,t){let n,r=t.target;if((n=rc(r)?{documents:{documents:[ix(e,r.path)]}}:{query:function(e,t){var n,r;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=ix(e,i);let o=function(e){if(0!==e.length)return function e(t){return t instanceof n5?function(e){if("=="===e.op){if(nK(e.value))return{unaryFilter:{field:iL(e.field),op:"IS_NAN"}};if(nH(e.value))return{unaryFilter:{field:iL(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(nK(e.value))return{unaryFilter:{field:iL(e.field),op:"IS_NOT_NAN"}};if(nH(e.value))return{unaryFilter:{field:iL(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:iL(e.field),op:iy[e.op],value:e.value}}}(t):t instanceof n4?function(t){let n=t.getFilters().map(t=>e(t));return 1===n.length?n[0]:{compositeFilter:{op:iv[t.op],filters:n}}}(t):tx(54877,{filter:t})}(n4.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:iL(e.field),direction:im[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let h=ib(e,t.limit);return null!==h&&(s.structuredQuery.limit=h),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{ft:s,parent:i}}(e,r).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=iT(e,t.resumeToken);let r=ib(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(t9.min())>0){n.readTime=iE(e,t.snapshotVersion.toTimestamp());let r=ib(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let n=function(e,t){let n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return tx(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){let t={};t.database=iN(this.serializer),t.removeTarget=e,this.q_(t)}}class sx extends sA{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return tk(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,tk(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,n;tk(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(tk(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?i_(e.updateTime):i_(n)).isEqual(t9.min())&&(t=i_(n)),new rG(t,e.transformResults||[])})):[]),i=i_(e.commitTime);return this.listener.na(i,r)}ra(){let e={};e.database=iN(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>(function(e,t){var n;let r;if(t instanceof rJ)r={update:iR(e,t.key,t.value)};else if(t instanceof r6)r={delete:iA(e,t.key)};else if(t instanceof rZ)r={update:iR(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof r3))return tx(16599,{Vt:t.type});r={verify:iA(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof rP)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof rV)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof rF)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof rj)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw tx(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(r.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:iE(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:tx(27497)),r})(this.serializer,e))};this.q_(t)}}class sN{}class sk extends sN{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new tL(tR.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Go(e,iS(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tR.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tL(tR.UNKNOWN,e.toString())})}Ho(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Ho(e,iS(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tR.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tL(tR.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class sR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(tC(t),this.aa=!1):tS("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const sL="RemoteStore";class sO{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{sq(this)&&(tS(sL,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await sP(e),e.Ra.set("Unknown"),e.Ea.delete(4),await sM(e)}(this))})}),this.Ra=new sR(n,r)}}async function sM(e){if(sq(e))for(let t of e.da)await t(!0)}async function sP(e){for(let t of e.da)await t(!1)}function sV(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),s$(e)?sj(e):s5(e).O_()&&sF(e,t))}function sU(e,t){let n=s5(e);e.Ia.delete(t),n.O_()&&sB(e,t),0===e.Ia.size&&(n.O_()?n.L_():sq(e)&&e.Ra.set("Unknown"))}function sF(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(t9.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}s5(e).Y_(t)}function sB(e,t){e.Va.Ue(t),s5(e).Z_(t)}function sj(e){e.Va=new id({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),s5(e).start(),e.Ra.ua()}function s$(e){return sq(e)&&!s5(e).x_()&&e.Ia.size>0}function sq(e){return 0===e.Ea.size}async function sz(e){e.Ra.set("Online")}async function sG(e){e.Ia.forEach((t,n)=>{sF(e,t)})}async function sH(e,t){e.Va=void 0,s$(e)?(e.Ra.ha(t),sj(e)):e.Ra.set("Unknown")}async function sK(e,t,n){if(e.Ra.set("Online"),t instanceof iu&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(n){tS(sL,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await sQ(e,n)}else if(t instanceof il?e.Va.Ze(t):t instanceof ih?e.Va.st(t):e.Va.tt(t),!n.isEqual(t9.min()))try{let t=await so(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.Va.Tt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(ny.EMPTY_BYTE_STRING,r.snapshotVersion)),sB(e,t);let i=new iP(r.target,t,n,r.sequenceNumber);sF(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){tS(sL,"Failed to raise snapshot:",t),await sQ(e,t)}}async function sQ(e,t,n){if(!ni(t))throw t;e.Ea.add(1),await sP(e),e.Ra.set("Offline"),n||(n=()=>so(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{tS(sL,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await sM(e)})}function sW(e,t){return t().catch(n=>sQ(e,n,t))}async function sX(e){var t;let n=s4(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;sq(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,function(e,t){e.Ta.push(t);let n=s4(e);n.O_()&&n.X_&&n.ea(t.mutations)}(e,t)}catch(t){await sQ(e,t)}sY(e)&&sJ(e)}function sY(e){return sq(e)&&!s4(e).x_()&&e.Ta.length>0}function sJ(e){s4(e).start()}async function sZ(e){s4(e).ra()}async function s0(e){let t=s4(e);for(let n of e.Ta)t.ea(n.mutations)}async function s1(e,t,n){let r=e.Ta.shift(),i=r4.from(r,t,n);await sW(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await sX(e)}async function s2(e,t){t&&s4(e).X_&&await async function(e,t){var n;if(function(e){switch(e){case tR.OK:return tx(64938);case tR.CANCELLED:case tR.UNKNOWN:case tR.DEADLINE_EXCEEDED:case tR.RESOURCE_EXHAUSTED:case tR.INTERNAL:case tR.UNAVAILABLE:case tR.UNAUTHENTICATED:return!1;case tR.INVALID_ARGUMENT:case tR.NOT_FOUND:case tR.ALREADY_EXISTS:case tR.PERMISSION_DENIED:case tR.FAILED_PRECONDITION:case tR.ABORTED:case tR.OUT_OF_RANGE:case tR.UNIMPLEMENTED:case tR.DATA_LOSS:return!0;default:return tx(15467,{code:e})}}(n=t.code)&&n!==tR.ABORTED){let n=e.Ta.shift();s4(e).B_(),await sW(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await sX(e)}}(e,t),sY(e)&&sJ(e)}async function s6(e,t){e.asyncQueue.verifyOperationInProgress(),tS(sL,"RemoteStore received new credentials");let n=sq(e);e.Ea.add(3),await sP(e),n&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await sM(e)}async function s3(e,t){t?(e.Ea.delete(2),await sM(e)):t||(e.Ea.add(2),await sP(e),e.Ra.set("Unknown"))}function s5(e){var t,n,r;return e.ma||(t=e.datastore,n=e.asyncQueue,r={Xo:sz.bind(null,e),t_:sG.bind(null,e),r_:sH.bind(null,e),H_:sK.bind(null,e)},t.sa(),e.ma=new sD(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.ma.B_(),s$(e)?sj(e):e.Ra.set("Unknown")):(await e.ma.stop(),e.Va=void 0)})),e.ma}function s4(e){var t,n,r;return e.fa||(t=e.datastore,n=e.asyncQueue,r={Xo:()=>Promise.resolve(),t_:sZ.bind(null,e),r_:s2.bind(null,e),ta:s0.bind(null,e),na:s1.bind(null,e)},t.sa(),e.fa=new sx(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.fa.B_(),await sX(e)):(await e.fa.stop(),e.Ta.length>0&&(tS(sL,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class s8{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new tO,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new s8(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new tL(tR.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function s7(e,t){if(tC("AsyncQueue",`${t}: ${e}`),ni(e))return new tL(tR.UNAVAILABLE,`${t}: ${e}`);throw e}class s9{static emptySet(e){return new s9(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||tZ.comparator(t.key,n.key):(e,t)=>tZ.comparator(e.key,t.key),this.keyedMap=rS(),this.sortedSet=new nu(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof s9)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new s9;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class ae{constructor(){this.ga=new nu(tZ.comparator)}track(e){let t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):tx(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class at{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new at(e,t,s9.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ry(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class an{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class ar{constructor(){this.queries=ai(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){let n=e.queries;e.queries=ai(),n.forEach((e,n)=>{for(let e of n.Sa)e.onError(t)})}(this,new tL(tR.ABORTED,"Firestore shutting down"))}}function ai(){return new rT(e=>rv(e),ry)}async function as(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.ba()&&t.Da()&&(n=2):(i=new an,n=+!t.Da());try{switch(n){case 0:i.wa=await e.onListen(r,!0);break;case 1:i.wa=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=s7(n,`Initialization of query '${rw(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&ah(e)}async function aa(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?r=+!t.Da():!i.ba()&&t.Da()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function ao(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.Sa)e.Fa(r)&&(n=!0);i.wa=r}}n&&ah(e)}function al(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.Sa)e.onError(n);e.queries.delete(t)}function ah(e){e.Ca.forEach(e=>{e.next()})}(E=b||(b={})).Ma="default",E.Cache="cache";class au{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new at(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.qa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=at.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==b.Cache}}class ac{constructor(e){this.key=e}}class af{constructor(e){this.key=e}}class ad{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=rN(),this.mutatedKeys=rN(),this.eu=rE(e),this.tu=new s9(this.eu)}get nu(){return this.Ya}ru(e,t){let n=t?t.iu:new ae,r=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let h=r.get(e),u=rb(this.query,t)?t:null,c=!!h&&this.mutatedKeys.has(h.key),f=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),d=!1;h&&u?h.data.isEqual(u.data)?c!==f&&(n.track({type:3,doc:u}),d=!0):this.su(h,u)||(n.track({type:2,doc:u}),d=!0,(o&&this.eu(u,o)>0||l&&0>this.eu(u,l))&&(a=!0)):!h&&u?(n.track({type:0,doc:u}),d=!0):h&&!u&&(n.track({type:1,doc:h}),d=!0,(o||l)&&(a=!0)),d&&(u?(s=s.add(u),i=f?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return tx(20277,{Rt:e})}};return n(e)-n(t)})(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),r=r??!1;let a=t&&!r?this._u():[],o=0===this.Xa.size&&this.current&&!r?1:0,l=o!==this.Za;return(this.Za=o,0!==s.length||l)?{snapshot:new at(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ae,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=rN(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});let t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new af(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new ac(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=rN();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return at.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const ap="SyncEngine";class ag{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class am{constructor(e){this.key=e,this.hu=!1}}class ay{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new rT(e=>rv(e),ry),this.Iu=new Map,this.Eu=new Set,this.du=new nu(tZ.comparator),this.Au=new Map,this.Ru=new i1,this.Vu={},this.mu=new Map,this.fu=iq.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function av(e,t,n=!0){let r,i=aF(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await ab(i,t,n,!0),r}async function aw(e,t){let n=aF(e);await ab(n,t,!0,!1)}async function ab(e,t,n,r){var i,s;let a,o=await (i=e.localStore,s=rg(t),i.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return i.Pi.getTargetData(e,s).next(n=>n?(t=n,nr.resolve(t)):i.Pi.allocateTargetId(e).next(n=>(t=new iP(s,n,"TargetPurposeListen",e.currentSequenceNumber),i.Pi.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=i.Ms.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(i.Ms=i.Ms.insert(e.targetId,e),i.xs.set(s,e.targetId)),e})),l=o.targetId,h=e.sharedClientState.addLocalQueryTarget(l,n);return r&&(a=await aE(e,t,l,"current"===h,o.resumeToken)),e.isPrimaryClient&&n&&sV(e.remoteStore,o),a}async function aE(e,t,n,r,i){e.pu=(t,n,r)=>(async function(e,t,n,r){let i=t.view.ru(n);i.Cs&&(i=await sh(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return aO(e,t.targetId,o.au),o.snapshot})(e,t,n,r);let s=await sh(e.localStore,t,!0),a=new ad(t,s.Qs),o=a.ru(s.documents),l=io.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),h=a.applyChanges(o,e.isPrimaryClient,l);aO(e,n,h.au);let u=new ag(t,n,a);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),h.snapshot}async function aT(e,t,n){let r=e.Tu.get(t),i=e.Iu.get(r.targetId);if(i.length>1)return e.Iu.set(r.targetId,i.filter(e=>!ry(e,t))),void e.Tu.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await sl(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&sU(e.remoteStore,r.targetId),aR(e,r.targetId)}).catch(nn)):(aR(e,r.targetId),await sl(e.localStore,r.targetId,!0))}async function a_(e,t){let n=e.Tu.get(t),r=e.Iu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),sU(e.remoteStore,n.targetId))}async function aI(e,t,n){var r,i;let s=((r=e).remoteStore.remoteSyncer.applySuccessfulWrite=aD.bind(null,r),r.remoteStore.remoteSyncer.rejectFailedWrite=ax.bind(null,r),r);try{let e,r=await function(e,t){let n,r,i=t7.now(),s=t.reduce((e,t)=>e.add(t.key),rN());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let o=r_,l=rN();return e.Ns.getEntries(a,s).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,o)).next(r=>{n=r;let s=[];for(let e of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=rM(r.transform,e||null);null!=i&&(null===n&&(n=nJ.empty()),n.set(r.field,i))}return n||null}(e,n.get(e.key).overlayedDocument);null!=t&&s.push(new rZ(e.key,t,function e(t){let n=[];return nl(t.fields,(t,r)=>{let i=new tJ([t]);if(nQ(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new ng(n)}(t.value.mapValue),rH.exists(!0)))}return e.mutationQueue.addMutationBatch(a,i,s,t)}).next(t=>{r=t;let i=t.applyToLocalDocumentSet(n,l);return e.documentOverlayCache.saveOverlays(a,t.batchId,i)})}).then(()=>({batchId:r.batchId,changes:rC(n)}))}(s.localStore,t);s.sharedClientState.addPendingMutation(r.batchId),i=r.batchId,(e=s.Vu[s.currentUser.toKey()])||(e=new nu(tz)),e=e.insert(i,n),s.Vu[s.currentUser.toKey()]=e,await aP(s,r.changes),await sX(s.remoteStore)}catch(t){let e=s7(t,"Failed to persist write");n.reject(e)}}async function aS(e,t){try{let n=await function(e,t){let n=t.snapshotVersion,r=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{var s,a,o;let l,h,u=e.Ns.newChangeBuffer({trackRemovals:!0});r=e.Ms;let c=[];t.targetChanges.forEach((s,a)=>{var o;let l=r.get(a);if(!l)return;c.push(e.Pi.removeMatchingKeys(i,s.removedDocuments,a).next(()=>e.Pi.addMatchingKeys(i,s.addedDocuments,a)));let h=l.withSequenceNumber(i.currentSequenceNumber);null!==t.targetMismatches.get(a)?h=h.withResumeToken(ny.EMPTY_BYTE_STRING,t9.min()).withLastLimboFreeSnapshotVersion(t9.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),r=r.insert(a,h),o=h,(0===l.resumeToken.approximateByteSize()||o.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&c.push(e.Pi.updateTargetData(i,h))});let f=r_,d=rN();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&c.push(e.persistence.referenceDelegate.updateLimboDocument(i,n))}),c.push((s=i,a=u,o=t.documentUpdates,l=rN(),h=rN(),o.forEach(e=>l=l.add(e)),a.getEntries(s,l).next(e=>{let t=r_;return o.forEach((n,r)=>{let i=e.get(n);r.isFoundDocument()!==i.isFoundDocument()&&(h=h.add(n)),r.isNoDocument()&&r.version.isEqual(t9.min())?(a.removeEntry(n,r.readTime),t=t.insert(n,r)):!i.isValidDocument()||r.version.compareTo(i.version)>0||0===r.version.compareTo(i.version)&&i.hasPendingWrites?(a.addEntry(r),t=t.insert(n,r)):tS(si,"Ignoring outdated watch update for ",n,". Current version:",i.version," Watch version:",r.version)}),{ks:t,qs:h}})).next(e=>{f=e.ks,d=e.qs})),!n.isEqual(t9.min())){let t=e.Pi.getLastRemoteSnapshotVersion(i).next(t=>e.Pi.setTargetsMetadata(i,i.currentSequenceNumber,n));c.push(t)}return nr.waitFor(c).next(()=>u.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,f,d)).next(()=>f)}).then(t=>(e.Ms=r,t))}(e.localStore,t);t.targetChanges.forEach((t,n)=>{let r=e.Au.get(n);r&&(tk(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?tk(r.hu,14607):t.removedDocuments.size>0&&(tk(r.hu,42227),r.hu=!1))}),await aP(e,n,t)}catch(e){await nn(e)}}function aC(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.Tu.forEach((e,n)=>{let r=n.view.va(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.Sa)e.va(t)&&(n=!0)}),n&&ah(r),i.length&&e.Pu.H_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function aA(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Au.get(t),i=r&&r.key;if(i){let n=new nu(tZ.comparator);n=n.insert(i,nZ.newNoDocument(i,t9.min()));let r=rN().add(i),s=new ia(t9.min(),new Map,new nu(tz),n,r);await aS(e,s),e.du=e.du.remove(i),e.Au.delete(t),aM(e)}else await sl(e.localStore,t,!1).then(()=>aR(e,t,n)).catch(nn)}async function aD(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(e,t,n,r){let i=n.batch,s=i.keys(),a=nr.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);tk(null!==s,48541),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))})(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=rN();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))}));ak(e,r,null),aN(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await aP(e,i)}catch(e){await nn(e)}}async function ax(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(tk(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));ak(e,t,n),aN(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await aP(e,i)}catch(e){await nn(e)}}function aN(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function ak(e,t,n){let r=e.Vu[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Vu[e.currentUser.toKey()]=r}}function aR(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||aL(e,t)})}function aL(e,t){e.Eu.delete(t.path.canonicalString());let n=e.du.get(t);null!==n&&(sU(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),aM(e))}function aO(e,t,n){for(let r of n)r instanceof ac?(e.Ru.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(tS(ap,"New document in limbo: "+n),e.Eu.add(r),aM(e))}(e,r)):r instanceof af?(tS(ap,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||aL(e,r.key)):tx(19791,{wu:r})}function aM(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let n=new tZ(tX.fromString(t)),r=e.fu.next();e.Au.set(r,new am(n)),e.du=e.du.insert(n,r),sV(e.remoteStore,new iP(rg(new rf(n.path)),r,"TargetPurposeLimboResolution",ns.ce))}}async function aP(e,t,n){let r=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,n).then(t=>{if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:n?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,r?"current":"not-current")}if(t){r.push(t);let e=st.As(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.H_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>nr.forEach(t,t=>nr.forEach(t.Es,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>nr.forEach(t.ds,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!ni(e))throw e;tS(si,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ms.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.Ms=e.Ms.insert(t,i)}}}(e.localStore,i))}async function aV(e,t){if(!e.currentUser.isEqual(t)){tS(ap,"User change. New user:",t.toKey());let n=await sa(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new tL(tR.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await aP(e,n.Ls)}}function aU(e,t){let n=e.Au.get(t);if(n&&n.hu)return rN().add(n.key);{let n=rN(),r=e.Iu.get(t);if(!r)return n;for(let t of r){let r=e.Tu.get(t);n=n.unionWith(r.view.nu)}return n}}function aF(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=aS.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=aU.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=aA.bind(null,e),e.Pu.H_=ao.bind(null,e.eventManager),e.Pu.yu=al.bind(null,e.eventManager),e}class aB{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sI(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,n;return t=this.persistence,n=new sr,new ss(t,n,e.initialUser,this.serializer)}Cu(e){return new i8(i9.mi,this.serializer)}Du(e){return new sc}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}aB.provider={build:()=>new aB};class aj extends aB{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return tk(this.persistence.referenceDelegate instanceof se,46915),new iK(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?i$.withCacheSize(this.cacheSizeBytes):i$.DEFAULT;return new i8(e=>se.mi(e,t),this.serializer)}}class a${async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>aC(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=aV.bind(null,this.syncEngine),await s3(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new ar}createDatastore(e){var t;let n=sI(e.databaseInfo.databaseId),r=new sT(e.databaseInfo);return t=e.authCredentials,new sk(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new sO(t,n,e.asyncQueue,e=>aC(this.syncEngine,e,0),sp.v()?new sp:new sf)}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){let o=new ay(e,t,n,r,i,s);return a&&(o.gu=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(e){tS(sL,"RemoteStore shutting down."),e.Ea.add(5),await sP(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}a$.provider={build:()=>new a$};class aq{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):tC("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const az="FirestoreClient";class aG{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=tE.UNAUTHENTICATED,this.clientId=tq.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{tS(az,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(tS(az,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new tO;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=s7(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function aH(e,t){e.asyncQueue.verifyOperationInProgress(),tS(az,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await sa(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function aK(e,t){e.asyncQueue.verifyOperationInProgress();let n=await aQ(e);tS(az,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>s6(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>s6(t.remoteStore,n)),e._onlineComponents=t}async function aQ(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){tS(az,"Using user provided OfflineComponentProvider");try{await aH(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===tR.FAILED_PRECONDITION||t.code===tR.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;tA("Error using user provided cache. Falling back to memory cache: "+t),await aH(e,new aB)}}else tS(az,"Using default OfflineComponentProvider"),await aH(e,new aj(void 0));return e._offlineComponents}async function aW(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(tS(az,"Using user provided OnlineComponentProvider"),await aK(e,e._uninitializedComponentsProvider._online)):(tS(az,"Using default OnlineComponentProvider"),await aK(e,new a$))),e._onlineComponents}async function aX(e){let t=await aW(e),n=t.eventManager;return n.onListen=av.bind(null,t.syncEngine),n.onUnlisten=aT.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=aw.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=a_.bind(null,t.syncEngine),n}function aY(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const aJ=new Map,aZ="firestore.googleapis.com";class a0{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new tL(tR.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=aZ,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new tL(tR.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new tL(tR.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=aY(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new tL(tR.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new tL(tR.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new tL(tR.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class a1{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new a0({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new tL(tR.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new tL(tR.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new a0(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new tP;switch(e.type){case"firstParty":return new tB(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new tL(tR.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=aJ.get(e);t&&(tS("ComponentProvider","Removing Datastore"),aJ.delete(e),t.terminate())}(this),Promise.resolve()}}class a2{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new a2(this.firestore,e,this._query)}}class a6{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new a3(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new a6(this.firestore,e,this._key)}toJSON(){return{type:a6._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(t8(t,a6._jsonSchema))return new a6(e,n||null,new tZ(tX.fromString(t.referencePath)))}}a6._jsonSchemaVersion="firestore/documentReference/1.0",a6._jsonSchema={type:t4("string",a6._jsonSchemaVersion),referencePath:t4("string")};class a3 extends a2{constructor(e,t,n){super(e,t,new rf(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new a6(this.firestore,null,new tZ(e))}withConverter(e){return new a3(this.firestore,e,this._path)}}function a5(e,t,...n){if(e=q(e),t0("collection","path",t),e instanceof a1){let r=tX.fromString(t,...n);return t2(r),new a3(e,null,r)}{if(!(e instanceof a6||e instanceof a3))throw new tL(tR.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(tX.fromString(t,...n));return t2(r),new a3(e.firestore,null,r)}}function a4(e,t,...n){if(e=q(e),1==arguments.length&&(t=tq.newId()),t0("doc","path",t),e instanceof a1){let r=tX.fromString(t,...n);return t1(r),new a6(e,null,new tZ(r))}{if(!(e instanceof a6||e instanceof a3))throw new tL(tR.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(tX.fromString(t,...n));return t1(r),new a6(e.firestore,e instanceof a3?e.converter:null,new tZ(r))}}const a8="AsyncQueue";class a7{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new sS(this,"async_queue_retry"),this._c=()=>{let e=s_();e&&tS(a8,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;let t=s_();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=s_();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new tO;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ni(e))throw e;tS(a8,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,tC("INTERNAL UNHANDLED ERROR: ",a9(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let r=s8.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&tx(47125,{Pc:a9(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function a9(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class oe extends a1{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new a7,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new a7(e),this._firestoreClient=void 0,await e}}}function ot(e){if(e._terminated)throw new tL(tR.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n;let r=e._freezeSettings(),i=(t=e._databaseId,n=e._app?.options.appId||"",new nx(t,n,e._persistenceKey,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,aY(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator));e._componentsProvider||r.localCache?._offlineComponentProvider&&r.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),e._firestoreClient=new aG(e._authCredentials,e._appCheckCredentials,e._queue,i,e._componentsProvider&&function(e){let t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class on{constructor(e){this._byteString=e}static fromBase64String(e){try{return new on(ny.fromBase64String(e))}catch(e){throw new tL(tR.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new on(ny.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:on._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(t8(e,on._jsonSchema))return on.fromBase64String(e.bytes)}}on._jsonSchemaVersion="firestore/bytes/1.0",on._jsonSchema={type:t4("string",on._jsonSchemaVersion),bytes:t4("string")};class or{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new tL(tR.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tJ(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class oi{constructor(e){this._methodName=e}}class os{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new tL(tR.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new tL(tR.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return tz(this._lat,e._lat)||tz(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:os._jsonSchemaVersion}}static fromJSON(e){if(t8(e,os._jsonSchema))return new os(e.latitude,e.longitude)}}os._jsonSchemaVersion="firestore/geoPoint/1.0",os._jsonSchema={type:t4("string",os._jsonSchemaVersion),latitude:t4("number"),longitude:t4("number")};class oa{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:oa._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(t8(e,oa._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new oa(e.vectorValues);throw new tL(tR.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}oa._jsonSchemaVersion="firestore/vectorValue/1.0",oa._jsonSchema={type:t4("string",oa._jsonSchemaVersion),vectorValues:t4("object")};const oo=/^__.*__$/;class ol{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new rZ(e,this.data,this.fieldMask,t,this.fieldTransforms):new rJ(e,this.data,t,this.fieldTransforms)}}class oh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new rZ(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function ou(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw tx(40011,{Ac:e})}}class oc{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new oc({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return o_(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(ou(this.Ac)&&oo.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class of{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||sI(e)}Cc(e,t,n,r=!1){return new oc({Ac:e,methodName:t,Dc:n,path:tJ.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function od(e){let t=e._freezeSettings(),n=sI(e._databaseId);return new of(e._databaseId,!!t.ignoreUndefinedProperties,n)}class op extends oi{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof op}}class og extends oi{_toFieldTransform(e){return new rz(e.path,new rP)}isEqual(e){return e instanceof og}}function om(e,t){if(ov(e=q(e)))return ow("Unsupported field value:",t,e),oy(e,t);if(e instanceof oi)return function(e,t){if(!ou(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=om(i,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}return function(e,t){var n,r,i;if(null===(e=q(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return n=t.serializer,"number"==typeof(i=r=e)&&Number.isInteger(i)&&!na(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER?rL(r):rR(n,r);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=t7.fromDate(e);return{timestampValue:iE(t.serializer,n)}}if(e instanceof t7){let n=new t7(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:iE(t.serializer,n)}}if(e instanceof os)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof on)return{bytesValue:iT(t.serializer,e._byteString)};if(e instanceof a6){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:iI(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof oa)return{mapValue:{fields:{[nR]:{stringValue:nM},[nP]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return rR(t.serializer,e)})}}}}};throw t.Sc(`Unsupported field value: ${t3(e)}`)}(e,t)}function oy(e,t){let n={};return nh(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):nl(e,(e,r)=>{let i=om(r,t.mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function ov(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof t7||e instanceof os||e instanceof on||e instanceof a6||e instanceof oi||e instanceof oa)}function ow(e,t,n){if(!ov(n)||!t6(n)){let r=t3(n);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function ob(e,t,n){if((t=q(t))instanceof or)return t._internalPath;if("string"==typeof t)return oT(e,t);throw o_("Field path arguments must be of type string or ",e,!1,void 0,n)}const oE=RegExp("[~\\*/\\[\\]]");function oT(e,t,n){if(t.search(oE)>=0)throw o_(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new or(...t.split("."))._internalPath}catch(r){throw o_(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function o_(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new tL(tR.INVALID_ARGUMENT,o+e+l)}function oI(e,t){return e.some(e=>e.isEqual(t))}class oS{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new a6(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new oC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(oA("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class oC extends oS{data(){return super.data()}}function oA(e,t){return"string"==typeof t?oT(e,t):t instanceof or?t._internalPath:t._delegate._internalPath}class oD{convertValue(e,t="none"){switch(nV(e)){case 0:return null;case 1:return e.booleanValue;case 2:return nb(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nE(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw tx(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return nl(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){return new oa(e.fields?.[nP].arrayValue?.values?.map(e=>nb(e.doubleValue)))}convertGeoPoint(e){return new os(nb(e.latitude),nb(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=nA(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(nD(e));default:return null}}convertTimestamp(e){let t=nw(e);return new t7(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=tX.fromString(e);tk(iM(n),9688,{name:e});let r=new nk(n.get(1),n.get(3)),i=new tZ(n.popFirst(5));return r.isEqual(t)||tC(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class ox{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class oN extends oS{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new ok(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(oA("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new tL(tR.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=oN._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}oN._jsonSchemaVersion="firestore/documentSnapshot/1.0",oN._jsonSchema={type:t4("string",oN._jsonSchemaVersion),bundleSource:t4("string","DocumentSnapshot"),bundleName:t4("string"),bundle:t4("string")};class ok extends oN{data(e={}){return super.data(e)}}class oR{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new ox(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new ok(this._firestore,this._userDataWriter,n.key,n,new ox(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new tL(tR.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new ok(e._firestore,e._userDataWriter,n.doc.key,n.doc,new ox(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new ok(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ox(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return tx(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new tL(tR.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=oR._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=tq.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}oR._jsonSchemaVersion="firestore/querySnapshot/1.0",oR._jsonSchema={type:t4("string",oR._jsonSchemaVersion),bundleSource:t4("string","QuerySnapshot"),bundleName:t4("string"),bundle:t4("string")};class oL extends oD{constructor(e){super(),this.firestore=e}convertBytes(e){return new on(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new a6(this.firestore,null,t)}}function oO(e){e=t5(e,a2);let t=t5(e.firestore,oe),n=ot(t),r=new oL(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new tL(tR.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),(function(e,t,n={}){let r=new tO;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new aq({next:n=>{s.Nu(),t.enqueueAndForget(()=>aa(e,a)),n.fromCache&&"server"===r.source?i.reject(new tL(tR.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),a=new au(n,s,{includeMetadataChanges:!0,qa:!0});return as(e,a)})(await aX(e),e.asyncQueue,t,n,r)),r.promise})(n,e._query).then(n=>new oR(t,r,e,n))}function oM(e,t){var n;let r=t5(e.firestore,oe),i=a4(e),s=(n=e.converter,n?n.toFirestore(t):t);return oP(r,[(function(e,t,n,r,i,s={}){let a,o,l=e.Cc(s.merge||s.mergeFields?2:0,t,n,i);ow("Data must be an object, but it was:",l,r);let h=oy(r,l);if(s.merge)a=new ng(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=ob(t,r,n);if(!l.contains(i))throw new tL(tR.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);oI(e,i)||e.push(i)}a=new ng(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new ol(new nJ(h),a,o)})(od(e.firestore),"addDoc",i._key,s,null!==e.converter,{}).toMutation(i._key,rH.exists(!1))]).then(()=>i)}function oP(e,t){var n=ot(e);let r=new tO;return n.asyncQueue.enqueueAndForget(async()=>aI(await aW(n).then(e=>e.syncEngine),t,r)),r.promise}new WeakMap,function(e=!0){tT="12.2.0",eT(new z("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new oe(new tU(t.getProvider("auth-internal")),new t$(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new tL(tR.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nk(e.options.projectId,t)}(i,n),i);return r={useFetchStreams:e,...r},s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),eC(tw,tb,void 0),eC(tw,tb,"esm2020")}();class oV{constructor(e,t,n,r,i,s,a){this.id=e,this.title=t,this.description=n,this.category=r,this.status=i,this.assigned=s,this.timestamp=a instanceof t7?a.toDate():a}}eC("firebase","12.2.1","app");const oU=function(e,t){let n=(function(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)})("object"==typeof e?e:function(e=em){let t=ev.get(e);if(!t&&e===em&&R())return eS();if(!t)throw e_.create("no-app",{appName:e});return t}(),"firestore").getImmediate({identifier:"string"==typeof e?e:nN});if(!n._initialized){let e=(e=>{let t=k()?.emulatorHosts?.[e];if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]})("firestore");e&&function(e,t,n,r={}){e=t5(e,a1);let i=O(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${n}`;i&&(M(`https://${o}`),function(e,t){if("undefined"==typeof window||"undefined"==typeof document||!O(window.location.host)||P[e]===t||P[e]||V)return;function n(e){return`__firebase__banner__${e}`}P[e]=t;let r="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(P))P[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(r),t=!1,e||((e=document.createElement("div")).setAttribute("id",r),t=!0),{created:t,element:e}),a=n("text"),o=document.getElementById(a)||document.createElement("span"),l=n("learnmore"),h=document.getElementById(l)||document.createElement("a"),u=n("preprendIcon"),c=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e=s.element;e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center",h.setAttribute("id",l),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline";let t=function(){let e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{V=!0;let e=document.getElementById(r);e&&e.remove()},e}();c.setAttribute("width","24"),c.setAttribute("id",u),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",e.append(c,o,h,t),document.body.appendChild(e)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}("Firestore",!0)),s.host!==aZ&&s.host!==o&&tA("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:r};if(!j(l,a)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=tE.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[x(JSON.stringify({alg:"none",type:"JWT"})),x(JSON.stringify(s)),""].join(".")}(r.mockUserToken,e._app?.options.projectId);let i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new tL(tR.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new tE(i)}e._authCredentials=new tV(new tM(t,n))}}(n,...e)}return n}(eS({apiKey:"AIzaSyAU1RpKD3mzYpNAUl4No9MAmytLWVpODuc",authDomain:"scrumboard-fe24.firebaseapp.com",projectId:"scrumboard-fe24",storageBucket:"scrumboard-fe24.appspot.com",messagingSenderId:"194278134561",appId:"1:194278134561:web:09f4a87077e71c1636e460",measurementId:"G-JN5840LZYZ"}));async function oF(e,t){if(!e||!t)throw Error("Invalid member data");return await oM(a5(oU,"members"),{name:e,role:t})}async function oB(){return(await oO(a5(oU,"members"))).docs.map(e=>({id:e.id,name:e.data().name??"",role:e.data().role??""}))}async function oj(e,t,n){if(!e||!t||!n)throw Error("Invalid task data");return await oM(a5(oU,"tasks"),{title:e,description:t,category:n,status:"new",assigned:null,timestamp:new og("serverTimestamp")})}async function o$(){return(await oO(a5(oU,"tasks"))).docs.map(e=>{let t=e.data();return{id:e.id,title:t.title??"",description:t.description??"",category:t.category??"",status:t.status??"new",assigned:t.assigned??null,timestamp:t.timestamp??new Date}})}async function oq(e,t){await function(e,t,n,...r){e=t5(e,a6);let i=t5(e.firestore,oe),s=od(i);return oP(i,[("string"==typeof(t=q(t))||t instanceof or?function(e,t,n,r,i,s){let a=e.Cc(1,t,n),o=[ob(t,r,n)],l=[i];if(s.length%2!=0)throw new tL(tR.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(ob(t,s[e])),l.push(s[e+1]);let h=[],u=nJ.empty();for(let e=o.length-1;e>=0;--e)if(!oI(h,o[e])){let t=o[e],n=l[e];n=q(n);let r=a.yc(t);if(n instanceof op)h.push(t);else{let e=om(n,r);null!=e&&(h.push(t),u.set(t,e))}}return new oh(u,new ng(h),a.fieldTransforms)}(s,"updateDoc",e._key,t,void 0,r):function(e,t,n,r){let i=e.Cc(1,t,n);ow("Data must be an object, but it was:",i,r);let s=[],a=nJ.empty();return nl(r,(e,r)=>{let o=oT(t,e,n);r=q(r);let l=i.yc(o);if(r instanceof op)s.push(o);else{let e=om(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new oh(a,new ng(s),i.fieldTransforms)}(s,"updateDoc",e._key,t)).toMutation(e._key,rH.exists(!0))])}(a4(oU,"tasks",e),t)}async function oz(e){var t;await oP(t5((t=a4(oU,"tasks",e)).firestore,oe),[new r6(t._key,rH.none())])}let oG=[],oH=[];const oK=document.getElementById("member-form"),oQ=document.getElementById("member-name"),oW=document.getElementById("member-role"),oX=document.getElementById("members-list"),oY=document.getElementById("task-form"),oJ=document.getElementById("task-title"),oZ=document.getElementById("task-desc"),o0=document.getElementById("task-category"),o1=document.getElementById("new-tasks"),o2=document.getElementById("in-progress"),o6=document.getElementById("done"),o3=document.getElementById("filter-member"),o5=document.getElementById("filter-category"),o4=document.getElementById("filter-assigned-only"),o8=document.getElementById("sort-option"),o7=document.getElementById("apply-filters"),o9=document.getElementById("clear-filters");function le(e,t){let n=e.trim().toLowerCase(),r=t.trim().toLowerCase();return r.includes("backend")?n.includes("backend"):r.includes("frontend")?n.includes("frontend"):!(r.includes("ux")||r.includes("ui"))||n.includes("ux")||n.includes("designer")}function lt(){oX&&(oX.innerHTML="",oG.forEach(e=>{let t=document.createElement("li");t.textContent=`${e.name} (${e.role})`,oX.appendChild(t)}))}function ln(e=oH){o1.innerHTML="<h2>New</h2>",o2.innerHTML="<h2>In Progress</h2>",o6.innerHTML="<h2>Done</h2>",e.forEach(e=>{let t=document.createElement("div");t.className="task-card",t.setAttribute("data-category",e.category.toLowerCase());let n=oG.filter(t=>le(t.role,e.category)).map(t=>`<option value="${t.id}" ${t.id===e.assigned?"selected":""}>${t.name}</option>`).join(""),r=e.assigned?"":"disabled";t.innerHTML=`
      <h3>${e.title}</h3>
      <p>${e.description}</p>
      <p><strong>Category:</strong> ${e.category}</p>
      <p><strong>Status:</strong> ${e.status}</p>
      <p><strong>Created:</strong> ${e.timestamp.toLocaleString()}</p>
      <label>Assign:
        <select class="assign-select" data-id="${e.id}">
          <option value="">Unassigned</option>
          ${n}
        </select>
      </label>
      <button class="done-btn" data-id="${e.id}" ${r}>Mark Done</button>
      <button class="delete-btn" data-id="${e.id}">Delete</button>
    `,"new"===e.status?o1.appendChild(t):"in-progress"===e.status?o2.appendChild(t):"done"===e.status&&o6.appendChild(t)}),document.querySelectorAll(".assign-select").forEach(e=>e.addEventListener("change",async e=>{let t=e.target,n=t.dataset.id,r=t.value||null,i=oG.find(e=>e.id===r),s=oH.find(e=>e.id===n);if(s){if(r&&i&&!le(i.role,s.category)){alert(`${i.name} (${i.role}) cannot be assigned to ${s.category} tasks.`),t.value=s.assigned??"";return}await oq(n,{assigned:r,status:r?"in-progress":"new"}),await ls()}})),document.querySelectorAll(".done-btn").forEach(e=>e.addEventListener("click",async e=>{let t=e.target.dataset.id,n=oH.find(e=>e.id===t);if(n){if(!n.assigned)return void alert("Assign the task before marking done.");await oq(t,{status:"done"}),await ls()}})),document.querySelectorAll(".delete-btn").forEach(e=>e.addEventListener("click",async e=>{let t=e.target.dataset.id;await oz(t),await ls()}))}function lr(){o3.innerHTML='<option value="">All Members</option>',oG.forEach(e=>{let t=document.createElement("option");t.value=e.id,t.textContent=`${e.name} (${e.role})`,o3.appendChild(t)})}function li(){let e,t,n,r,i=[...oH];o4.checked&&(i=i.filter(e=>e.assigned&&"done"!==e.status)),o3.value&&(e=i,t=o3.value,i=e.filter(e=>e.assigned===t)),o5.value&&(n=i,r=o5.value,i=n.filter(e=>e.category===r));let s=o8.value;if(s.startsWith("timestamp")){let e,t;e=i,t=s.endsWith("asc")?"asc":"desc",i=e.sort((e,n)=>"asc"===t?e.timestamp.getTime()-n.timestamp.getTime():n.timestamp.getTime()-e.timestamp.getTime())}else{let e,t;s.startsWith("title")&&(e=i,t=s.endsWith("asc")?"asc":"desc",i=e.sort((e,n)=>"asc"===t?e.title.localeCompare(n.title):n.title.localeCompare(e.title)))}return i}async function ls(){oG=(await oB()).map(e=>new _(e.id,e.name,e.role)),lt(),lr(),oH=(await o$()).map(e=>new oV(e.id,e.title,e.description,e.category,e.status,e.assigned,e.timestamp.toDate?e.timestamp.toDate():new Date(e.timestamp))),ln()}oK.addEventListener("submit",async e=>{e.preventDefault();let t=oQ.value.trim(),n=oW.value.trim();if(t&&n){let e=await oF(t,n);oG.push(new _(e.id,t,n)),lt(),lr(),oK.reset()}}),oY.addEventListener("submit",async e=>{e.preventDefault();let t=oJ.value.trim(),n=oZ.value.trim(),r=o0.value;t&&n&&r&&(await oj(t,n,r),await ls(),oY.reset())}),o7.addEventListener("click",e=>{e.preventDefault(),ln(li())}),o9.addEventListener("click",e=>{e.preventDefault(),o3.value="",o5.value="",o4.checked=!1,o8.value="",ln()}),[o3,o5,o4,o8].forEach(e=>e.addEventListener("change",()=>ln(li()))),ls();
//# sourceMappingURL=ScrumBoardNew.bbbc4044.js.map
